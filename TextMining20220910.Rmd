---
title: "TextMining"
author: "wi19m047"
date: "8/31/2022"
output:
    latex_engine: xelatex
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
options(stringsAsFactors = F)
Sys.setlocale("LC_ALL", "de_DE.UTF-8")
```

# UC.00 Softwareanwendung vorbereiten
## Die gesammelten Bibliotheken
```{r}
# für das Textmining unter UC.01, UC.02
library(tm)
library(pdftools)
library(NLP)
library(SnowballC)

# für den UC.06 Informationen visualisieren
library(ggplot2)
library(ggcorrplot)
library(ggdendro)
library(gridExtra)
library(ggthemes)
library(qdap)
library(ggpubr)
library(wordcloud)

# für das Clustering und die Validierung des UC.03, UC.04 und UC.05
library(cluster)
library(lsa)
library(LSAfun)
library(gplots)
library(topicmodels)
library(factoextra)
library(NbClust)
library(clusterSim)
library(fpc)

# für den UC.07 Informationen austauschen
library(lubridate)
library(xlsx)
library(xlsxjars)
library(rJava)
library(fossil)

```

## Bereich für zentrale und globale Funktionen
### Funktionen um Zeichen bzw. Wörter zu entfernen
```{r}
# removal of words with pattern
remove.word <- content_transformer(function(x, pattern) {
  return(replace(x, grep(pattern, x),""))
  })

# removal of characters with pattern
remove.character <- content_transformer(function(x, pattern) {
  return(gsub(pattern, "",x))
  })

```

### die Definitionen der Stopwörter
```{r}
# define own stopwords
stopwords_own <- c("lol","smh","delta","may","#","dm","ng","pls","n","sa","tel","oj","c","p","tom","cam","i","ii","iii","iv","t","v","footnote","also","always","among","amongst","although","altogether","will","can","vom","von","yes","zur","tkg","tkk","april","august")

# combine own stopwords with predefined ones
custom.stopwords.en.defined <- unique(c(stopwords("english"),stopwords_en, stopwords_own))
custom.stopwords.en.total<-c(stopwords("english"),stopwords_en, stopwords_own)

# give an overview
stopword.length.df <- data.frame("Anzahl" = c(length(stopwords_own),length(stopwords("english")), length(stopwords_en), length(custom.stopwords.en.defined)), row.names = c("manuelle Definition","tm-package","lsa-package","unique"))

```

### try-catch function for ToLower processing
```{r}
# Function, return NA instead of tolower error
tryTolower<-function(x){
  # return NA when there is an error
  y = NA
  # tryCatch error
  try_error = tryCatch(tolower(x), error = function(e) e)
  # if not an error
  if (!inherits(try_error,"error"))
    y = tolower(x)
  return(y)
}
```

### eine zentrale Funktion um den Textkorpus zu erstellen (Bestandteil der Vorverarbeitung)
```{r}
build.corpus<-function(corpus) {
  
  # tolower function
  corpus <- tm_map(corpus, content_transformer(tryTolower))
  
  # removal of stopwords
  corpus <- tm_map(corpus, removeWords, custom.stopwords.en.defined)

  # removal of certain words
  corpus <- tm_map(corpus, remove.word, "http*")
  corpus <- tm_map(corpus, remove.word, "www*")
  corpus <- tm_map(corpus, remove.word, "abwicklungsstell*")
  corpus <- tm_map(corpus, remove.word, "aecfdigitalstrategi")
  corpus <- tm_map(corpus, remove.word, "alexand*")
  corpus <- tm_map(corpus, remove.word, "angelegenheit*")
  corpus <- tm_map(corpus, remove.word, "anhalt*")
  
  # removal of certain characters
  corpus <- tm_map(corpus, remove.character, "*”")
  corpus <- tm_map(corpus, remove.character, "‘*")
  corpus <- tm_map(corpus, remove.character, "“*")
  corpus <- tm_map(corpus, remove.character, "“*“")
  corpus <- tm_map(corpus, remove.character, "*’")
  corpus <- tm_map(corpus, remove.character, "*–*")
  
  # removal of punctuation
  corpus <- tm_map(corpus, removePunctuation, preserve_intra_word_contradictions = F, preserve_intra_word_dashes = F)
  
  # removal of whitespaces
  corpus <- tm_map(corpus, stripWhitespace)
  
  # removal of numbers
  corpus <- tm_map(corpus, removeNumbers)
  
  # stemming
  corpus <- tm_map(corpus, stemDocument, language = "english")
  # corpus <- tm_map(corpus, stemCompletion)
  
  return(corpus)
}
```

### Funktionen um den Textkorpus mit Metadaten anzureichern
```{r}
corpus.idx.df <- function() {
  
  vector.1 <- c()
  vector.2 <- c()
  
  for (x in 1:length(corpus)) {
    
    vector.1 <- append(vector.1, meta(corpus[[x]], tag = "id"))
    vector.2 <- append(vector.2, x)
    
  }
  
  df <- data.frame(vector.1, vector.2)
  return(df)
  
}
```

### function to extract certain values from a capture.output.object of a provided tdm- or dtm-matrix
```{r}
extract.values.from.capture.output <- function(capture.output.obj) {
  
  out <- strsplit(capture.output.obj," ")
  terms.cnt <- as.numeric(gsub(",","",out[[1]][3]))
  nonsparse.entries <- as.numeric(strsplit(out[[2]][3],"/")[[1]][1])
  sparse.entries <- as.numeric(strsplit(out[[2]][3],"/")[[1]][2])
  sparsity <- out[[3]][13]
  max.term.len <- as.numeric(out[[4]][4])
  
  return(data.frame(terms.cnt,nonsparse.entries,sparse.entries,sparsity,max.term.len))
}
```

### load external metadata for corpus enrichment
```{r}
# load certain metadata from a file
# UC.07 Informationen austauschen
rawdata <- read.csv(file = "~/data/corpus.eval.values.v2.csv", sep = ";")
eval.df <- data.frame(rawdata, row.names = "id")

```

### to enrich the corpus with metadata
```{r}
# map alphanumeric parameter values to numeric values

eval.df["relevance"][eval.df["relevance"] == ""] <- NA
eval.df["relevance"][eval.df["relevance"] == "l"] <- 0.33
eval.df["relevance"][eval.df["relevance"] == "h"] <- 0.99
eval.df["relevance"][eval.df["relevance"] == "m"] <- 0.66
eval.df$relevance <- as.numeric(eval.df$relevance)

eval.df["quality"][eval.df["quality"] == 1] <- 0.99
eval.df["quality"][eval.df["quality"] == 2] <- 0.75
eval.df["quality"][eval.df["quality"] == 3] <- 0.50
eval.df["quality"][eval.df["quality"] == 4] <- 0.25
eval.df["quality"][eval.df["quality"] == 5] <- 0.01
```

## definitions of global variables
```{r}
# parameters for the creation of term-document-matrices
minWordLength <- 3
tdm.tf.minWordLength <- minWordLength
tdm.tfidf.minWordLength <- minWordLength
dtm.tf.minWordLength <- minWordLength
dtm.tfidf.minWordLength <- minWordLength

# UC.06, UC.07 corpus version festlegen (verwendet für Dateinamen)
cv <- 1
```

# UC.01 Dokumente-Korpus anlegen
## import all documents from of an input directory and built a document vcorpus 
```{r}
# GitHub repository
file.path <- file.path("~/MT2022/docs")
corpus.raw.file <- VCorpus(DirSource(file.path), readerControl = list(reader = readPDF, language = "en"))
corpus.raw.file.doc.cnt <- as.numeric(strsplit(capture.output(corpus.raw.file)[[3]],":")[[1]][3])
paste("Der Korpus (corpus.raw.file) enthält",corpus.raw.file.doc.cnt,"Dokumente.")
```

## remove documents in the corpus due to "0" chars values
### mark the documents
```{r}

df <- data.frame()

for (item in 1:length(corpus.raw.file)) {
  out <- capture.output(corpus.raw.file[[item]])
  out <- as.vector(strsplit(out,":"))
  chars <- as.integer(out[[3]][3])
  df <- rbind(df,chars)
}

df <- apply(df, 1, as.numeric)
df.neg <- !df
paste("Aus dem Korpus (corpus.raw.file) soll entfernt werden:")

for (item in 1:length(df.neg)) {
  
  if (df.neg[item]) {
    print(corpus.raw.file[[item]]$meta$id)
    meta(corpus.raw.file[[item]], tag = "delete") <- T
    #corpus.raw[[item]] = NULL
  } else meta(corpus.raw.file[[item]], tag = "delete") <- F
}
```

### remove the marked documents
```{r}
# versionen des corpus ablegen
corpus.raw <- corpus.raw.file

# die zuvor markierten dokumente werden entfernt
item <- length(corpus.raw)
print("Aus dem Korpus (corpus.raw) wurde entfernt:")

while (item > 0) {
  if (corpus.raw[[item]]$meta$delete) {
    print(corpus.raw[[item]]$meta$id)
    corpus.raw[[item]] = NULL
    item = item - 1
  }
  item = item - 1
}

corpus.raw.doc.cnt <- as.numeric(strsplit(capture.output(corpus.raw)[[3]],":")[[1]][3])
paste("Der Korpus (corpus.raw) enthält",corpus.raw.doc.cnt,"Dokumente.")

```

## build the corpus
```{r}
corpus <- build.corpus(corpus.raw)

corpus.doc.cnt <- as.numeric(strsplit(capture.output(corpus)[[3]],":")[[1]][3])
paste("Der Korpus (corpus) enthält",corpus.doc.cnt,"Dokumente.")

```

## remove documents in the corpus due to "0" chars values
### mark the documents
```{r}
df <- data.frame()

for (item in 1:length(corpus)) {
  out <- capture.output(corpus[[item]])
  out <- as.vector(strsplit(out,":"))
  chars <- as.integer(out[[3]][3])
  df <- rbind(df,chars)
}

df <- apply(df, 1, as.numeric)
df.neg <- !df

print("Aus dem Korpus (corpus) sollen entfernt werden:")
for (item in 1:length(df.neg)) {
  
  if (df.neg[item]) {
    print(corpus[[item]]$meta$id)
    meta(corpus[[item]], tag = "delete") <- T
    #corpus.raw[[item]] = NULL
  } else meta(corpus[[item]], tag = "delete") <- F
}
```

### remove the marked documents
```{r}
item <- length(corpus)
print("Aus dem Korpus (corpus) wurden entfernt:")

while (item > 0) {
  if (corpus[[item]]$meta$delete) {
    print(corpus[[item]]$meta$id)
    corpus[[item]] = NULL
    item = item - 1
  }
  item = item - 1
}

corpus.doc.cnt <- as.numeric(strsplit(capture.output(corpus)[[3]],":")[[1]][3])
paste("Der Korpus (corpus) besteht aus",corpus.doc.cnt,"Dokumenten.")
```

## save data locally
```{r}
df <- corpus.idx.df()

# UC.07 Informationen austauschen
write.xlsx(df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/corpus.idx.cv",cv,".xlsx", sep=""))
```

## enrich the corpus with external metadata
### function to fill empty metadata with NA-value
```{r}
replace.meta.info <- function(corpus) {
  
  for (item in 1:length(corpus)) {
    if(is.null(corpus[[item]]$meta$author)) meta(corpus[[item]], tag = "author") <- c("NA")
    if(is.null(corpus[[item]]$meta$description)) meta(corpus[[item]], tag = "description") <- c("NA")
    if(is.null(corpus[[item]]$meta$datetimestamp)) meta(corpus[[item]], tag = "datetimestamp") <- c("NA")
    if(is.null(corpus[[item]]$meta$heading)) meta(corpus[[item]], tag = "heading") <- c("NA")
    if(is.null(corpus[[item]]$meta$id)) meta(corpus[[item]], tag = "id") <- c("NA")
    if(is.null(corpus[[item]]$meta$language)) meta(corpus[[item]], tag = "language") <- c("NA")
    if(is.null(corpus[[item]]$meta$origin)) meta(corpus[[item]], tag = "origin") <- c("NA")
  }
  return(corpus)
}
```

### fill emtpy metadata with NA-values
```{r}
corpus <- replace.meta.info(corpus)
```

### enrich the corpus with external meta-data
```{r}
for (x in 1:length(corpus)) {
  search.tag <- meta(corpus[[x]], tag = "id")
  meta(corpus[[x]], tag = "eval.quality") <- eval.df["quality"][eval.df["vector.1"] == search.tag]
  meta(corpus[[x]], tag = "eval.relevance") <- eval.df["relevance"][eval.df["vector.1"] == search.tag]
  meta(corpus[[x]], tag = "eval.sano") <- eval.df["sano"][eval.df["vector.1"] == search.tag]
  meta(corpus[[x]], tag = "eval.subject") <- eval.df["subject"][eval.df["vector.1"] == search.tag]
  meta(corpus[[x]], tag = "eval.date") <- as.POSIXct.Date(as.Date(eval.df["date"][eval.df["vector.1"] == search.tag], tryFormats = c("%d.%m.%Y")))
  meta(corpus[[x]], tag = "eval.state") <- eval.df["state"][eval.df["vector.1"] == search.tag]
  meta(corpus[[x]], tag = "eval.region") <- eval.df["region"][eval.df["vector.1"] == search.tag]
  meta(corpus[[x]], tag = "eval.decno") <- eval.df["decno"][eval.df["vector.1"] == search.tag]
}
```

### give an overview of the corpus metadata
```{r}
# export an overview of the corpus
df <- data.frame()

for (item in 1:length(corpus)) {
  text <- c(corpus[[item]]$meta$author,
            as.character(corpus[[item]]$meta$datetimestamp),
            corpus[[item]]$meta$description,
            corpus[[item]]$meta$heading,
            corpus[[item]]$meta$id,
            corpus[[item]]$meta$language,
            corpus[[item]]$meta$origin,
            corpus[[item]]$meta$eval.quality,
            corpus[[item]]$meta$eval.relevance,
            corpus[[item]]$meta$eval.sano,
            corpus[[item]]$meta$eval.subject,
            corpus[[item]]$meta$eval.date,
            corpus[[item]]$meta$eval.state,
            corpus[[item]]$meta$eval.region,
            corpus[[item]]$meta$eval.decno
            )
  # text <- c(corpus[[item]]$meta$id)
  df <- rbind(df, text)
}

colnames(df) <- c("Author","Date","Description","Heading","ID","Language","Origin","Quality","Relevance","State-Aid-No.","Subject","Date","MemberState","MemberRegion","Decision-No.")

# UC.07 Informationen austauschen
write.xlsx(df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/corpus.info.cv",cv,".xlsx", sep=""))
```

## investigate the corpus
```{r}
# UC.06 Informationen visualisieren
paste("Der Korpus (corpus) besteht aus",as.numeric(strsplit(capture.output(corpus)[[3]],":")[[1]][3]),"Dokumenten.")
```

## save the corpus locally
```{r}
# UC.07 Informationen austauschen
# writeCorpus(corpus, filenames = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/corpus.c",cv,".data", sep = ""))
```

# UC.02 Grundlagen der Zusammenhangs-Analyse festlegen
## definition area
### a list to store all UC.02 related xlsx based data
```{r}
uc02_xlsx_list <- list()
```

### global function to store data as xlsx, csv and table
```{r}
uc07_data <- function(data_object,type,version = T) {
  file_name <- as.character(substitute(data_object))
  
  if (!version) {
    id <- cv
  } else {
    id <- paste(cv,cc,sep = "")
  }
  
  if (type == "xlsx") {
    write.xlsx(data_object, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/",file_name,"_",id,".xlsx", sep=""))
    # print(paste(type,id))
  }
   else if (type == "csv") {
   write.csv(data_object, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/",file_name,"_",id,".csv", sep=""))
    # print(paste(type,id))
} else if (type == "tbl") {
   write.table(data_object,paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/",file_name,"_",id,".csv", sep=""))
  # print(paste(type,id))
} else {
  print("false date provided, nothing saved locally!")
}
}

```

## build the TermDocumentMatrices by TermFrequency as well as TermFrequencyInverseDocumentFrequency 
```{r}
tdm.tf <- TermDocumentMatrix(corpus, control = list(weighting=weightTf, minWordLength = tdm.tf.minWordLength))
tdm.tfidf <- TermDocumentMatrix(corpus, control = list(weighting=weightTfIdf, minWordLength = tdm.tfidf.minWordLength))
```

## build the DocumentTermMatrices by TermFrequency as well as TermFrequencyInverseDocumentFrequency
```{r}
dtm.tf <- DocumentTermMatrix(corpus, control = list(weighting=weightTf,minWordLength = dtm.tf.minWordLength))
dtm.tfidf <- DocumentTermMatrix(corpus, control = list(weighting=weightTfIdf,minWordLength = dtm.tfidf.minWordLength))
```

### save the Matrices locally
```{r}
# UC.07 Informationen austauschen
tdm.tf.disp <- as.matrix(tdm.tf)
uc07_data(tdm.tf.disp,"csv",F)

tdm.tfidf.disp <- as.matrix(tdm.tfidf)
uc07_data(tdm.tfidf.disp,"csv",F)
# write.csv(as.matrix(tdm.tf), file = "~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.matrix.csv")

```

### analyse the Matrices
#### an initial impression about the tdm matrices
```{r}
print("Term-Document-Matrix (term-frequency):")
# for tdm.tf
tdm.tf.summary.table <- as.table(summary(tdm.tf$v))

print("Term-Document-Matrix (term-frequency-inverse-document-frequency:")
# for tdm.tfidf
tdm.tfidf.summary.table <- as.table(summary(tdm.tfidf$v))

# UC.06 Informationen visualisieren
tdm.summary.table <- data.frame(as.numeric(tdm.tf.summary.table))
tdm.summary.table <- cbind(tdm.summary.table, as.numeric(tdm.tfidf.summary.table))
row.names(tdm.summary.table) <- names(tdm.tf.summary.table)
tdm.summary.table <- t(tdm.summary.table)
row.names(tdm.summary.table) <- c("tdm.tf","tdm.tfidf")

as.data.frame(tdm.summary.table)

# tdm statistics
# UC.06 Informationen visualisieren

tdm.tf.summary <- extract.values.from.capture.output(capture.output(tdm.tf))
tdm.tfidf.summary <- extract.values.from.capture.output(capture.output(tdm.tfidf))

tdm.tf.summary.disp <- tdm.tf.summary
tdm.tfidf.summary.disp <- tdm.tfidf.summary

colnames(tdm.tf.summary.disp) <- c("Terms","Non-sparse entries","Sparse entries","Sparsity","Max. term length")
row.names(tdm.tf.summary.disp) <- c("tdm.tf")
# tdm.tf.summary.disp

colnames(tdm.tfidf.summary.disp) <- c("Terms","Non-sparse entries","Sparse entries","Sparsity","Max. term length")
row.names(tdm.tfidf.summary.disp) <- c("tdm.tfidf")
# tdm.tfidf.summary.disp

tdm.tf_tfidf.summary.disp <- rbind(tdm.tf.summary.disp,tdm.tfidf.summary.disp)
tdm.tf_tfidf.summary.disp

# UC.07 Informationen austauschen
uc02_xlsx_list <- append(uc02_xlsx_list, list(tdm.tf_tfidf.summary = as.data.frame(tdm.summary.table)))
uc07_data(tdm.tf.summary.disp,"xlsx",F)

# write.xlsx(tdm.summary.disp, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.summary.table_",cv,".xlsx", sep=""))

uc02_xlsx_list <- append(uc02_xlsx_list, list(tdm.tf_tfidf.ov = tdm.tf_tfidf.summary.disp))
uc07_data(tdm.tf_tfidf.summary.disp,"xlsx",F)
# write.xlsx(tdm.tf_tfidf.summary.disp, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf_tfidf.summary.disp_",cv,".xlsx", sep=""))

```

#### get the TopNMostFreqTerms
```{r}
TopNMostFreqTerms <- 10
tdm.tf.MostFreqTerms <- unlist(findMostFreqTerms(tdm.tf, n = TopNMostFreqTerms))
tdm.tfidf.MostFreqTerms <- unlist(findMostFreqTerms(tdm.tfidf, n = TopNMostFreqTerms))

# UC.07 share information
uc07_data(tdm.tf.MostFreqTerms,"csv",F)
uc07_data(tdm.tfidf.MostFreqTerms,"csv",F)

```

### evaluate the sparsity of the matrices
#### an attempt to reduce the sparsity (the features) of the matrices via the overall tf- and tfidf-median (reference: "topicmodels: An R Package for Fitting Topic Models, Grün, Hornik, 2011")
```{r}
# transform the tdm
tdm.tf.matrix <- as.matrix(tdm.tf)
tdm.tf.df <- as.data.frame(tdm.tf.matrix)

# row-wise calculation of the median for tf
tdm.tf.median.rw <- apply(tdm.tf.df[,-1],1,median)
tdm.tf.df <- cbind(tdm.tf.df, tdm.tf.median.rw)

# tdm.tf.df$row_median = apply(tdm.tf.df[,-1],1,median)

# transform the tdm
tdm.tfidf.matrix <- as.matrix(tdm.tfidf)
tdm.tfidf.df <- as.data.frame(tdm.tfidf.matrix)

# row-wise calculation of the median for tfidf
tdm.tfidf.median.rw <- apply(tdm.tfidf.df[,-1],1,median)
tdm.tfidf.df <- cbind(tdm.tfidf.df, tdm.tfidf.median.rw)

# tdm.tfidf.df$row_median = apply(tdm.tfidf.df[,-1],1,median)

# determine the overall median of the tdm for tf
tdm.tf.median <- round(median(tdm.tf$v))
features.above.tf.median <- row.names(tdm.tf.df[tdm.tf.df$tdm.tf.median.rw > tdm.tf.median,])

# determine the overall media of the tdm for tfidf
temp.table.summary <- as.table(summary(tdm.tfidf$v))
temp.table.quantile <- as.table(quantile(tdm.tfidf$v, probs = c(0,.05,.1,.2,.25,.3,.4,.5,.6,.7,.75,.8,.9,1)))
tdm.tfidf.median <- round(median(tdm.tfidf$v), digits = 4)
features.above.tfidf.median <- row.names(tdm.tfidf.df[tdm.tfidf.df$tdm.tfidf.median.rw > tdm.tfidf.median,])

# reduce the sparsity of the tdm for tf and tfidf
tdm.tf.features.reducedby.tf <- tdm.tf[features.above.tf.median,]
tdm.tf.features.reducedby.tfidf <- tdm.tf[features.above.tfidf.median,]
tdm.tfidf.features.reducedby.tfidf <- tdm.tfidf[features.above.tfidf.median,]

# UC.06 Informationen visualisieren
temp.table.summary
temp.table.quantile

# UC.07 Informationen austauschen
uc07_data(tdm.tf.df,"tbl",F)
uc07_data(tdm.tfidf.df,"tbl",F)
# write.table(tdm.tf.df,paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.df_",cv,".csv", sep=""), sep = ",")
# write.table(tdm.tfidf.df,paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.df_",cv,".csv", sep=""), sep = ",")

tdm.tfidf.temp.table.summary <- as.array(temp.table.summary)
uc07_data(tdm.tfidf.temp.table.summary,"tbl",F)
tdm.tfidf.temp.table.quantile <- as.array(temp.table.quantile)
uc07_data(tdm.tfidf.temp.table.quantile,"tbl",F)

# write.table(as.array(temp.table.summary),paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/sparse.term.var1.summary_",cv,".csv", sep=""))
# write.table(as.array(temp.table.quantile),paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/sparse.term.var1.quantile_",cv,".csv", sep=""))

```

#### an alternative approach to reduce the sparsity of the tdm.tf based upon the tm's removeSparseTerms function
```{r}
# evaluation of appropriate sparsity values for the function removeSparseTerms for tdm.tf

temp.out <- capture.output(tdm.tf)
split.out.nse <- strsplit(temp.out[2], split = ":")
split.out.sparsity <- strsplit(temp.out[3], split = ":")
split.out.mtl <- strsplit(temp.out[4], split = ":")


tdm.tf.sparsity.value.eval <- data.frame()
tdm.tf.sparsity.value.eval <- rbind(tdm.tf.sparsity.value.eval,c("orig",as.numeric(tdm.tf$nrow),as.numeric(summary(tdm.tf$v)),split.out.nse[[1]][2],split.out.sparsity[[1]][2], split.out.mtl[[1]][2]))


# df <- data.frame()
# df <- rbind(df,c("orig",as.numeric(tdm.tf$nrow),as.numeric(summary(tdm.tf$v)),split.out.nse[[1]][2],split.out.sparsity[[1]][2], split.out.mtl[[1]][2]))

for (sparsity in c(0.99,0.95,0.9,0.85,0.8,0.75,0.7,0.65,0.6,0.55,0.5,0.45,0.4,0.35,0.3,0.25,0.2,0.15,0.1,0.05,0.01)) {
  temp <- removeSparseTerms(tdm.tf, sparsity)
  temp.out <- capture.output(temp)
  split.out.nse <- strsplit(temp.out[2], split = ":")
  split.out.sparsity <- strsplit(temp.out[3], split = ":")
  split.out.mtl <- strsplit(temp.out[4], split = ":")
  output <- c(sparsity,as.numeric(temp$nrow),as.numeric(summary(temp$v)),split.out.nse[[1]][2],split.out.sparsity[[1]][2], split.out.mtl[[1]][2])
  #print(summary(temp$v))
  tdm.tf.sparsity.value.eval <- rbind(tdm.tf.sparsity.value.eval,output)
}
colnames(tdm.tf.sparsity.value.eval) <- c("sparsity","features",names(summary(temp$v)),"Non-/sparse entries","Sparsity","Maximal term length")
tdm.tf.sparsity.value.eval <- transform(tdm.tf.sparsity.value.eval, features = as.numeric(features))
# df
```

##### visualize the results
```{r}
# UC.06, visualize the evaluation results

tdm.tf.sparsity.value.eval.ggplot <- ggplot(data = tdm.tf.sparsity.value.eval, aes(x=`sparsity`,y=features)) +geom_bar(stat = "identity") +ggtitle("Evaluation of sparsity value for feature reduction", subtitle = "TermDocumentMatrix based upon term-frequencies") +xlab("selected sparsity value") +ylab("amount of remaining features\nper selected sparsity value")

tdm.tf.sparsity.value.eval.ggplot

# UC.07 Informationen austauschen
ggsave(paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tf.sparsity.value.eval.ggplot_",cv,".png", sep=""), plot = tdm.tf.sparsity.value.eval.ggplot)

uc02_xlsx_list <- append(uc02_xlsx_list, list(tdm.tf.sparsity.value.eval = tdm.tf.sparsity.value.eval))
uc07_data(tdm.tf.sparsity.value.eval,"xlsx",F)
# write.xlsx(tdm.tf.sparsity.value.eval, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.sparsity.value.eval_",cv,".xlsx", sep=""))

```
##### set the sparsity value
```{r}
# set the sparsity value for removeSparseTerms function manually for tdm.tf
tdm.tf.sparsity.value.suggested <- 0.95

# call the function to remove sparse terms
tdm.tf.features.reducedby.rst <- removeSparseTerms(tdm.tf, tdm.tf.sparsity.value.suggested)

```

#### another approach to reduce the sparsity of the tfidf-tdm based upon the removeSparseTerms function
```{r}
# evaluation of appropriate sparsity values for the function removeSparseTerms for tdm.tfidf

temp.out <- capture.output(tdm.tfidf)
split.out.nse <- strsplit(temp.out[2], split = ":")
split.out.sparsity <- strsplit(temp.out[3], split = ":")
split.out.mtl <- strsplit(temp.out[4], split = ":")

tdm.tfidf.sparsity.value.eval <- data.frame()
tdm.tfidf.sparsity.value.eval <- rbind(tdm.tfidf.sparsity.value.eval,c("orig",as.numeric(tdm.tfidf$nrow),as.numeric(summary(tdm.tfidf$v)),split.out.nse[[1]][2],split.out.sparsity[[1]][2], split.out.mtl[[1]][2]))

for (sparsity in c(0.99,0.95,0.9,0.85,0.8,0.75,0.7,0.65,0.6,0.55,0.5,0.45,0.4,0.35,0.3,0.25,0.2,0.15,0.1,0.05,0.01)) {
  temp <- removeSparseTerms(tdm.tfidf, sparsity)
  temp.out <- capture.output(temp)
  split.out.nse <- strsplit(temp.out[2], split = ":")
  split.out.sparsity <- strsplit(temp.out[3], split = ":")
  split.out.mtl <- strsplit(temp.out[4], split = ":")
  output <- c(sparsity,as.numeric(temp$nrow),as.numeric(summary(temp$v)),split.out.nse[[1]][2],split.out.sparsity[[1]][2], split.out.mtl[[1]][2])
  #print(summary(temp$v))
  tdm.tfidf.sparsity.value.eval <- rbind(tdm.tfidf.sparsity.value.eval,output)
}
colnames(tdm.tfidf.sparsity.value.eval) <- c("sparsity","features",names(summary(temp$v)),"Non-/sparse entries","Sparsity","Maximal term length")
tdm.tfidf.sparsity.value.eval <- transform(tdm.tfidf.sparsity.value.eval, features = as.numeric(features))
# df
```

##### visualize the results
```{r}
# UC.06, visualize the evaluation results

tdm.tfidf.sparsity.value.eval.ggplot <- ggplot(data = tdm.tfidf.sparsity.value.eval, aes(x=`sparsity`,y=features)) +geom_bar(stat = "identity") +ggtitle("Evaluation of sparsity value for feature reduction", subtitle = "TermDocumentMatrix based upon term-frequencies-inverse-document-frequency") +xlab("selected sparsity value") +ylab("amount of remaining features\nper selected sparsity value")

tdm.tfidf.sparsity.value.eval.ggplot

# UC.07 Informationen austauschen
ggsave(paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.sparsity.value.eval.ggplot_",cv,".png", sep = ""), plot = tdm.tfidf.sparsity.value.eval.ggplot)

uc02_xlsx_list <- append(uc02_xlsx_list, list(tdm.tfidf.sparsity.value.eval = tdm.tfidf.sparsity.value.eval))
uc07_data(tdm.tfidf.sparsity.value.eval,"xlsx",F)
#write.xlsx(tdm.tfidf.sparsity.value.eval, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.sparsity.value.eval_",cv,".xlsx", sep=""))
```
##### set the sparsity value
```{r}
# set the sparsity value for removeSparseTerms function manually for tdm.tfidf

tdm.tfidf.sparsity.value.suggested <- 0.95

# call the function to remove sparse terms
tdm.tfidf.features.reducedby.rst <- removeSparseTerms(tdm.tfidf, tdm.tfidf.sparsity.value.suggested)

```

### summary of the results by the sparsity reduction actions for tdm.tf and tdm.tfidf
```{r}
# UC.06 Informationen visualieren
tdm.tf.summary <- rbind(tdm.tf.summary,extract.values.from.capture.output(capture.output(tdm.tf.features.reducedby.tfidf)),extract.values.from.capture.output(capture.output(tdm.tf.features.reducedby.rst)))
tdm.tf.summary

tdm.tfidf.summary <- rbind(tdm.tfidf.summary,extract.values.from.capture.output(capture.output(tdm.tfidf.features.reducedby.tfidf)),extract.values.from.capture.output(capture.output(tdm.tfidf.features.reducedby.rst)))
tdm.tfidf.summary

colnames(tdm.tf.summary) <- c("Terms","Non-sparse entries","Sparse entries","Sparsity","Max. term length")
row.names(tdm.tf.summary) <- c("tdm.tf","tdm.tf.redby.tfidf","tdm.tf.redby.rst")
tdm.tf.summary

colnames(tdm.tfidf.summary) <- c("Terms","Non-sparse entries","Sparse entries","Sparsity","Max. term length")
row.names(tdm.tfidf.summary) <- c("tdm.tfidf","tdm.tfidf.redby.tfidf","tdm.tfidf.redby.rst")
tdm.tfidf.summary

# UC.07 Informationen austauschen

uc02_xlsx_list <- append(uc02_xlsx_list, list(tdm.tf.summary = tdm.tf.summary))
uc02_xlsx_list <- append(uc02_xlsx_list, list(tdm.tfidf.summary = tdm.tfidf.summary))

uc07_data(tdm.tf.summary,"xlsx",F)
uc07_data(tdm.tfidf.summary,"xlsx",F)

# write.xlsx(tdm.tf.summary, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.summary.table_",cv,".xlsx", sep=""))
# write.xlsx(tdm.tfidf.summary, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.summary.table_",cv,".xlsx", sep=""))

```

### transform the tdm.tf and tdm.tfidf into matrices and dataframes for further processing
```{r}
# tdm tf matrices
tdm.tf.matrix <- as.matrix(tdm.tf)
tdm.tf.matrix.df <- data.frame(tdm.tf.matrix)
tdm.tf.features.reducedby.tfidf.matrix <- as.matrix(tdm.tf.features.reducedby.tfidf)
tdm.tf.features.reducedby.tfidf.matrix.df <- data.frame(tdm.tf.features.reducedby.tfidf.matrix)
tdm.tf.features.reducedby.rst.matrix <- as.matrix(tdm.tf.features.reducedby.rst)
tdm.tf.features.reducedby.rst.matrix.df <- data.frame(tdm.tf.features.reducedby.rst.matrix)

# tdm tfidf matrices
tdm.tfidf.matrix <- as.matrix(tdm.tfidf)
tdm.tfidf.matrix.df <- data.frame(tdm.tfidf.matrix)
tdm.tfidf.features.reducedby.tfidf.matrix <- as.matrix(tdm.tfidf.features.reducedby.tfidf)
tdm.tfidf.features.reducedby.tfidf.matrix.df <- data.frame(tdm.tfidf.features.reducedby.tfidf.matrix)
tdm.tfidf.features.reducedby.rst.matrix <- as.matrix(tdm.tfidf.features.reducedby.rst)
tdm.tfidf.features.reducedby.rst.matrix.df <- data.frame(tdm.tfidf.features.reducedby.rst.matrix)

# dtm tf matrices
dtm.tf.matrix <- as.matrix(dtm.tf)
dtm.tf.matrix.df <- data.frame(dtm.tf.matrix)
dtm.tf.features.reducedby.tfidf <- t(tdm.tf.features.reducedby.tfidf)
dtm.tf.features.reducedby.rst <- t(tdm.tf.features.reducedby.rst)
dtm.tf.features.reducedby.tfidf.matrix <- t(tdm.tf.features.reducedby.tfidf.matrix)
dtm.tf.features.reducedby.tfidf.matrix.df <- data.frame(dtm.tf.features.reducedby.tfidf.matrix)
dtm.tf.features.reducedby.rst.matrix <- t(tdm.tf.features.reducedby.rst.matrix)
dtm.tf.features.reducedby.rst.matrix.df <- data.frame(dtm.tf.features.reducedby.rst.matrix)

# dtm tfidf matrices
dtm.tfidf.matrix <- as.matrix(dtm.tfidf)
dtm.tfidf.matrix.df <- data.frame(dtm.tfidf.matrix)
dtm.tfidf.features.reducedby.tfidf <- t(tdm.tf.features.reducedby.tfidf)
dtm.tfidf.features.reducedby.rst <- t(tdm.tf.features.reducedby.rst)
dtm.tfidf.features.reducedby.tfidf.matrix <- t(tdm.tfidf.features.reducedby.tfidf.matrix)
dtm.tfidf.features.reducedby.tfidf.matrix.df <- data.frame(dtm.tfidf.features.reducedby.tfidf.matrix)
dtm.tfidf.features.reducedby.rst.matrix <- t(tdm.tfidf.features.reducedby.rst.matrix)
dtm.tfidf.features.reducedby.rst.matrix.df <- data.frame(dtm.tfidf.features.reducedby.rst.matrix)
```

### local storage of all matrices
```{r}
uc02_xlsx_list <- append(uc02_xlsx_list, list(tdm.tf_tfidf = tdm.tf.features.reducedby.tfidf.matrix))
uc02_xlsx_list <- append(uc02_xlsx_list, list(tdm.tf_rst = tdm.tf.features.reducedby.rst.matrix))
uc02_xlsx_list <- append(uc02_xlsx_list, list(tdm.tfidf_tfidf = tdm.tfidf.features.reducedby.tfidf.matrix))
uc02_xlsx_list <- append(uc02_xlsx_list, list(tdm.tfidf_rst = tdm.tfidf.features.reducedby.rst.matrix))

uc07_data(tdm.tf.features.reducedby.tfidf.matrix,"xlsx",F)
uc07_data(tdm.tfidf.features.reducedby.tfidf.matrix,"xlsx",F)
uc07_data(tdm.tf.features.reducedby.rst.matrix,"xlsx",F)
uc07_data(tdm.tfidf.features.reducedby.rst.matrix,"xlsx",F)

# write.xlsx(tdm.tf.features.reducedby.tfidf.matrix, file = "~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.features.reducedby.tfidf.matrix.xlsx")
# # 
# write.xlsx(tdm.tfidf.features.reducedby.tfidf.matrix, file = "~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.features.reducedby.tfidf.matrix.xlsx")
# # 
# write.csv(tdm.tf.features.reducedby.rst.matrix,file="~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.features.reducedby.rst.matrix.csv")
# # 
# write.csv(tdm.tfidf.features.reducedby.rst.matrix,file="~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.features.reducedby.rst.matrix.csv")

```

## visualisations of the corpus and term-document-matrix with wordcloud (UC.06, UC.07)
### wordcloud visualisation for the whole corpus
```{r}
set.seed(1234)
corpus.feature.freq.min <- 200
wordcloud(corpus, min.freq = corpus.feature.freq.min, scale = c(3.0,0.2), random.order = F, rot.per = 0.35, colors = brewer.pal(8, "Dark2"))
```
### wordcloud visualisation for tdm.tf
```{r}
set.seed(1234)
v <- sort(rowSums(as.matrix(tdm.tf)), decreasing = T)
df <- data.frame(word = names(v), freq = v)
corpus.feature.freq.min <- 200
wordcloud(df$word, df$freq, min.freq = corpus.feature.freq.min, scale = c(3.0,0.2), random.order = F, rot.per = 0.35, colors = brewer.pal(8, "Dark2"))
```

### wordcloud visualisation for tdm.tfidf
```{r}
set.seed(1234)
v <- sort(rowSums(as.matrix(tdm.tfidf)), decreasing = T)
df <- data.frame(word = names(v), freq = v)
corpus.feature.freq.min <- 0.13
wordcloud(df$word, df$freq, min.freq = corpus.feature.freq.min, scale = c(3.0,0.2), random.order = F, rot.per = 0.35, colors = brewer.pal(8, "Dark2"))
```

### wordcloud visualisation of the features for the tdm.tf.features.reducedby.tfidf
```{r}
v <- sort(rowSums(tdm.tf.features.reducedby.tfidf.matrix), decreasing = T)
df <- data.frame(word = names(v), freq = v)
set.seed(1234)
wordcloud(df$word, df$freq, scale = c(3.0,0.2), random.order = F, rot.per = 0.35, colors = brewer.pal(8, "Dark2"))
```

#### tabular representation of the features for tdm.tf.features.reducedby.tfidf
```{r}
# UC.06 Informationen visualisieren
tdm.tf.matrix.sum <- rowSums(as.matrix(tdm.tf.features.reducedby.tfidf))

tdm.tf.matrix.sum.df <- data.frame(word=names(tdm.tf.matrix.sum),frequency=tdm.tf.matrix.sum)
tdm.tf.matrix.sum.df <- tdm.tf.matrix.sum.df[order(tdm.tf.matrix.sum.df[,2], decreasing = T),]
tdm.tf.matrix.sum.df$word <- factor(tdm.tf.matrix.sum.df$word, levels = unique(as.character(tdm.tf.matrix.sum.df$word)))

topN.feature.value <- 50
if (nrow(tdm.tf.matrix.sum.df) < topN.feature.value)  {topN.feature.value = nrow(tdm.tf.matrix.sum.df)}

ggplot.all <- ggplot(tdm.tf.matrix.sum.df[1:topN.feature.value,], aes(x=reorder(word,+frequency),y=frequency)) +geom_bar(stat="identity", fill = 'darkred') +coord_flip() +theme_gdocs() +geom_text(aes(label=frequency), colour="white", hjust=1.25, size=3) +ggtitle("Features in the Corpus", subtitle = "Barplot for TopN-features reduced by statistical value (Var.1); tdm.tf.features.reducedby.tfidf") +ylab("total number by feature") +xlab("feature name") +theme(plot.title = element_text(size = 14), axis.title = element_text(size = 12), text = element_text(size = 10))
ggplot.all

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tf.features.reducedby.tfidf.topn_",cv,".pdf", sep = ""), plot = ggplot.all, dpi = 300)
```

### wordcloud visualisation of the features for the tdm.tfidf.features.reducedby.tfidf
```{r}
v <- sort(rowSums(tdm.tfidf.features.reducedby.tfidf.matrix), decreasing = T)
df <- data.frame(word = names(v), freq = v)
set.seed(1234)
wordcloud(df$word, df$freq, scale = c(3.0,0.2), random.order = F, rot.per = 0.35, colors = brewer.pal(8, "Dark2"))
```

#### tabular representation of the features for tdm.tfidf.features.reducedby.tfidf
```{r}
# UC.06 Informationen visualisieren
tdm.tfidf.matrix.sum <- rowSums(as.matrix(tdm.tfidf.features.reducedby.tfidf))

tdm.tfidf.matrix.sum.df <- data.frame(word=names(tdm.tfidf.matrix.sum),frequency=tdm.tfidf.matrix.sum)
tdm.tfidf.matrix.sum.df <- tdm.tfidf.matrix.sum.df[order(tdm.tfidf.matrix.sum.df[,2], decreasing = T),]
tdm.tfidf.matrix.sum.df$word <- factor(tdm.tfidf.matrix.sum.df$word, levels = unique(as.character(tdm.tfidf.matrix.sum.df$word)))

topN.feature.value <- 50
if (nrow(tdm.tfidf.matrix.sum.df) < topN.feature.value)  {topN.feature.value = nrow(tdm.tfidf.matrix.sum.df)}

ggplot.all <- ggplot(tdm.tfidf.matrix.sum.df[1:topN.feature.value,], aes(x=reorder(word,+frequency),y=frequency)) +geom_bar(stat="identity", fill = 'darkred') +coord_flip() +theme_gdocs() +geom_text(aes(label=frequency), colour="white", hjust=1.25, size=3) +ggtitle("Features in the Corpus", subtitle = "Barplot for TopN-features reduced by statistical value (Var.1); tdm.tfidf.features.reducedby.tfidf") +ylab("total number by feature") +xlab("feature name") +theme(plot.title = element_text(size = 14), axis.title = element_text(size = 12), text = element_text(size = 10))
ggplot.all

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.features.reducedby.tfidf.topn_",cv,".pdf", sep = ""), plot = ggplot.all, dpi = 300)
```

### wordcloud visualisation of the features for the tdm.tf.features.reducedby.rst
```{r}
# visualize the tdm.tf.features.reducedby.rst.matrix
rst.feature.freq.min <- 750
v <- sort(rowSums(tdm.tf.features.reducedby.rst.matrix), decreasing = T)
df <- data.frame(word = names(v), freq = v)
set.seed(1234)
wordcloud(df$word, df$freq, scale = c(3.0,0.2), random.order = F, rot.per = 0.35, colors = brewer.pal(8, "Dark2"), min.freq = rst.feature.freq.min)

```

#### tabular representation of the features for tdm.tf.features.reducedby.rst
```{r}
# UC.06  Informationen visualisieren
# specify the input data to be used
tdm.tf.matrix.sum <- rowSums(tdm.tf.features.reducedby.rst.matrix)

write.csv(tdm.tf.matrix.sum,file="~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.matrix.sum.csv")

tdm.tf.matrix.sum.df <- data.frame(word=names(tdm.tf.matrix.sum),frequency=tdm.tf.matrix.sum)
tdm.tf.matrix.sum.df <- tdm.tf.matrix.sum.df[order(tdm.tf.matrix.sum.df[,2], decreasing = T),]
tdm.tf.matrix.sum.df$word <- factor(tdm.tf.matrix.sum.df$word, levels = unique(as.character(tdm.tf.matrix.sum.df$word)))

# set the amount of features to be included
# topN.feature.value <- nrow(tdm.tf.matrix.sum.df)
topN.feature.value <- 50
if (nrow(tdm.tf.matrix.sum.df) < topN.feature.value)  {topN.feature.value = nrow(tdm.tf.matrix.sum.df)}

ggplot.all <- ggplot(tdm.tf.matrix.sum.df[1:topN.feature.value,], aes(x=reorder(word,+frequency),y=frequency)) +geom_bar(stat="identity", fill = 'darkred') +coord_flip() +theme_gdocs() +geom_text(aes(label=frequency), colour="white", hjust=1.25, size=1.5) +ggtitle("Features in the Corpus", subtitle = paste("TopN-features reduced by tm::removeSparseTerms() (Var. 2); tdm.tf.features.reducedby.rst; sparsity-value: ",tdm.tf.sparsity.value.suggested,"; TopN-value:",topN.feature.value)) +ylab("total number by feature") +xlab("feature name") +theme(plot.title = element_text(size = 14), axis.title = element_text(size = 12), text = element_text(size = 6))
ggplot.all

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tf.features.reducedby.rst.matrix.topn_",cv,".pdf", sep = ""), plot = ggplot.all, dpi = 300)
```
### wordcloud visualisation of the features for the tdm.tfidf.features.reducedby.rst
```{r}
# visualize the tdm.tfidf.features.reducedby.rst.matrix
rst.feature.freq.min <- 0.157
v <- sort(rowSums(tdm.tfidf.features.reducedby.rst.matrix), decreasing = T)
df <- data.frame(word = names(v), freq = v)
set.seed(1234)
wordcloud(df$word, df$freq, scale = c(3.0,0.2), random.order = F, rot.per = 0.35, colors = brewer.pal(8, "Dark2"), min.freq = rst.feature.freq.min)

```

#### tabular representation of the features for tdm.tfidf.features.reducedby.rst
```{r}
# UC.06  Informationen visualisieren
# specify the input data to be used
tdm.tfidf.matrix.sum <- rowSums(tdm.tfidf.features.reducedby.rst.matrix)

tdm.tfidf.matrix.sum.df <- data.frame(word=names(tdm.tfidf.matrix.sum),frequency=tdm.tfidf.matrix.sum)
tdm.tfidf.matrix.sum.df <- tdm.tfidf.matrix.sum.df[order(tdm.tfidf.matrix.sum.df[,2], decreasing = T),]
tdm.tfidf.matrix.sum.df$word <- factor(tdm.tfidf.matrix.sum.df$word, levels = unique(as.character(tdm.tfidf.matrix.sum.df$word)))

# set the amount of features to be included
# topN.feature.value <- nrow(tdm.tf.matrix.sum.df)
topN.feature.value <- 50
if (nrow(tdm.tfidf.matrix.sum.df) < topN.feature.value)  {topN.feature.value = nrow(tdm.tfidf.matrix.sum.df)}

ggplot.all <- ggplot(tdm.tfidf.matrix.sum.df[1:topN.feature.value,], aes(x=reorder(word,+frequency),y=frequency)) +geom_bar(stat="identity", fill = 'darkred') +coord_flip() +theme_gdocs() +geom_text(aes(label=frequency), colour="white", hjust=1.25, size=1.5) +ggtitle("Features in the Corpus", subtitle = paste("TopN-features reduced by tm::removeSparseTerms() (Var. 2); tdm.tfidf.features.reducedby.rst; sparsity-value: ",tdm.tf.sparsity.value.suggested,"; TopN-value:",topN.feature.value)) +ylab("total number by feature") +xlab("feature name") +theme(plot.title = element_text(size = 14), axis.title = element_text(size = 12), text = element_text(size = 6))
ggplot.all

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.features.reducedby.rst.matrix.topn_",cv,".pdf", sep = ""), plot = ggplot.all, dpi = 300)
```
## save the data as xlsx files
```{r}
# uc02_wb = createWorkbook(type = "xlsx")
# 
# for (item in 1:length(uc02_xlsx_list)) {
#   sheet = createSheet(uc02_wb, sheetName = names(uc02_xlsx_list)[item])
#   addDataFrame(as.data.frame(uc02_xlsx_list[[item]]), sheet = sheet)
# }
# 
# saveWorkbook(uc02_wb,paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/uc02_wb_",cv,".xlsx", sep=""))

```

# UC.03 Parameter der Zusammenhangs-Analyse festlegen
## definition area
### a list to store all UC.03 related xlsx based data
```{r}
uc03_xlsx_list <- list()
```

## determine the cluster tendency (Hopkins test and Visual Assessment of cluster Tendency)
```{r}
# Hopkins statistic: If the value of Hopkins statistic is close to 1 (far above 0.5), then we can conclude that the dataset is significantly clusterable. VAT (Visual Assessment of cluster Tendency): The VAT detects the clustering tendency in a visual form by counting the number of square shaped dark (or colored) blocks along the diagonal in a VAT image.

tdm.tf.features.reducedby.tfidf.matrix.gct <- get_clust_tendency(tdm.tf.features.reducedby.tfidf.matrix, nrow(tdm.tf.features.reducedby.tfidf.matrix)-1, seed = 1234)
tdm.tf.features.reducedby.rst.matrix.gct <- get_clust_tendency(tdm.tf.features.reducedby.rst.matrix, nrow(tdm.tf.features.reducedby.rst.matrix)-1, seed = 1234)
tdm.tfidf.features.reducedby.tfidf.matrix.gct <- get_clust_tendency(tdm.tfidf.features.reducedby.tfidf.matrix, nrow(tdm.tfidf.features.reducedby.tfidf.matrix)-1, seed = 1234)
tdm.tfidf.features.reducedby.rst.matrix.gct <- get_clust_tendency(tdm.tfidf.features.reducedby.rst.matrix, nrow(tdm.tfidf.features.reducedby.rst.matrix)-1, seed = 1234)

# UC.06 Informationen visualisieren
tdm.tf_tfidf.gct <- data.frame(TDM_ClusterTendency = c(tdm.tf.features.reducedby.tfidf.matrix.gct$hopkins_stat, tdm.tf.features.reducedby.rst.matrix.gct$hopkins_stat, tdm.tfidf.features.reducedby.tfidf.matrix.gct$hopkins_stat, tdm.tfidf.features.reducedby.rst.matrix.gct$hopkins_stat), row.names = c("tf_tfidf","tf_rst","tfidf_tfidf","tfidf_rst"))
tdm.tf_tfidf.gct <- t(tdm.tf_tfidf.gct)
tdm.tf_tfidf.gct

# UC.07 Informationen austauschen
uc03_xlsx_list <- append(uc03_xlsx_list, list(tdm.tf_tfidf.gct = tdm.tf_tfidf.gct))
uc07_data(tdm.tf_tfidf.gct,"xlsx",F)
# write.xlsx(tdm.tf_tfidf.gct, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf_tfidf.gct_",cv,".xlsx", sep=""))

```

## evaluate the cluster count with the elbow method fviz_nbclust function, kmeans
### for dtm.tf.features.reducedby.tfidf
```{r}
# estimate the number of clusters by elbow method
# references:
# http://www.sthda.com/english/articles/29-cluster-validation-essentials/96-determiningthe-optimal-number-of-clusters-3-must-know-methods/

set.seed(1234)
cluster.eval.max.cnt <- 15
cluster.eval.nboot <- 500
cluster.cnt.ex_ante <- 2

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss <- fviz_nbclust(dtm.tf.features.reducedby.tfidf.matrix, kmeans, method = "wss", k.max = cluster.eval.max.cnt, nboot = cluster.eval.nboot) 

dtm.tf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss <- dtm.tf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss +geom_vline(xintercept = cluster.cnt.ex_ante, linetype = 2) +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Elbow method; dtm.tf.features.reducedby.tfidf; kmeans; WSS")

dtm.tf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss.clust_cnt <- 2
```

### for dtm.tfidf.features.reducedby.tfidf
```{r}
# estimate the number of clusters by elbow method
# references:
# http://www.sthda.com/english/articles/29-cluster-validation-essentials/96-determiningthe-optimal-number-of-clusters-3-must-know-methods/

set.seed(1234)
cluster.cnt.ex_ante <- 3

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss <- fviz_nbclust(dtm.tfidf.features.reducedby.tfidf.matrix, kmeans, method = "wss", k.max = cluster.eval.max.cnt, nboot = cluster.eval.nboot) 

dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss <- dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss +geom_vline(xintercept = cluster.cnt.ex_ante, linetype = 2) +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Elbow method; dtm.tfidf.features.reducedby.tfidf; kmeans; WSS")

dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss.clust_cnt <- 3
```

### for dtm.tf.features.reducedby.rst
```{r}
set.seed(1234)
cluster.cnt.ex_ante <- 2

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss <- fviz_nbclust(dtm.tf.features.reducedby.rst.matrix, kmeans, method = "wss", k.max = cluster.eval.max.cnt, nboot = cluster.eval.nboot) 

dtm.tf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss <- dtm.tf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss +geom_vline(xintercept = cluster.cnt.ex_ante, linetype = 2) +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Elbow method; dtm.tf.features.reducedby.rst; kmeans; WSS")

dtm.tf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss.clust_cnt <- 2

```

### for dtm.tfidf.features.reducedby.rst
```{r}
set.seed(1234)
cluster.cnt.ex_ante <- 2

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss <- fviz_nbclust(dtm.tfidf.features.reducedby.rst.matrix, kmeans, method = "wss", k.max = cluster.eval.max.cnt, nboot = cluster.eval.nboot) 

dtm.tfidf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss <- dtm.tfidf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss +geom_vline(xintercept = cluster.cnt.ex_ante, linetype = 2) +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Elbow method; dtm.tfidf.features.reducedby.rst; kmeans; WSS")

dtm.tfidf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss.clust_cnt <- 2

```


## evaluate the cluster count with the silhouette method, fviz_nbclust function, kmeans
### for dtm.tf.features.reducedby.tfidf
```{r}
# estimate the number of clusters by silhouette method
# references:
# http://www.sthda.com/english/articles/29-cluster-validation-essentials/96-determiningthe-optimal-number-of-clusters-3-must-know-methods/

set.seed(1234)
cluster.cnt.ex_ante <- 2

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans <- fviz_nbclust(dtm.tf.features.reducedby.tfidf.matrix, kmeans, method = "silhouette", k.max = cluster.eval.max.cnt, nboot = cluster.eval.nboot) 

dtm.tf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans <- dtm.tf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans +geom_vline(xintercept = cluster.cnt.ex_ante, linetype = 2) +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Silhouette method; dtm.tf.features.reducedby.tfidf; kmeans; silhouette")

dtm.tf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans.wss.clust_cnt <- 2

```

### for dtm.tfidf.features.reducedby.tfidf
```{r}
# estimate the number of clusters by silhouette method
# references
# http://www.sthda.com/english/articles/29-cluster-validation-essentials/96-determiningthe-optimal-number-of-clusters-3-must-know-methods/

set.seed(1234)
cluster.cnt.ex_ante <- 3

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans <- fviz_nbclust(dtm.tfidf.features.reducedby.tfidf.matrix, kmeans, method = "silhouette", k.max = cluster.eval.max.cnt, nboot = cluster.eval.nboot) 

dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans <- dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans +geom_vline(xintercept = cluster.cnt.ex_ante, linetype = 2) +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Silhouette method; dtm.tfidf.features.reducedby.tfidf; kmeans; silhouette")

dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans.wss.clust_cnt <- 3

```

### for dtm.tf.features.reducedby.rst
```{r}
set.seed(1234)
cluster.cnt.ex_ante <- 2

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans <- fviz_nbclust(dtm.tf.features.reducedby.rst.matrix, kmeans, method = "silhouette", k.max = cluster.eval.max.cnt, nboot = cluster.eval.nboot) + geom_vline(xintercept = cluster.cnt.ex_ante, linetype = 2) +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Silhouette method; dtm.tf.features.reducedby.rst; kmeans; silhouette")

dtm.tf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans.wss.clust_cnt <- 2
```

### for dtm.tfidf.features.reducedby.rst
```{r}
set.seed(1234)
cluster.cnt.ex_ante <- 2

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans <- fviz_nbclust(dtm.tfidf.features.reducedby.rst.matrix, kmeans, method = "silhouette", k.max = cluster.eval.max.cnt, nboot = cluster.eval.nboot) + geom_vline(xintercept = cluster.cnt.ex_ante, linetype = 2) +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Silhouette method; dtm.tfidf.features.reducedby.rst; kmeans; silhouette")

dtm.tfidf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans.wss.clust_cnt <- 2
```

## evaluate the cluster count with the gap statistic method, fviz_nbclust function, kmeans
### for dtm.tf.features.reducedby.tfidf
```{r}
# estimate the number of clusters by gap-statistic method
# references:
# http://www.sthda.com/english/articles/29-cluster-validation-essentials/96-determiningthe-optimal-number-of-clusters-3-must-know-methods/

set.seed(1234)

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans <- fviz_nbclust(dtm.tf.features.reducedby.tfidf.matrix, kmeans, method = "gap_stat", nboot = cluster.eval.nboot, nstart = 25, k.max = cluster.eval.max.cnt) 

dtm.tf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans <- dtm.tf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Gap statistic method; dtm.tf.features.reducedby.tfidf; kmeans; gap statistic")

dtm.tf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans.clust_cnt <- 7

```

### for dtm.tfidf.features.reducedby.tfidf
```{r}
# estimate the number of clusters by gap-statistic method
# references:
# http://www.sthda.com/english/articles/29-cluster-validation-essentials/96-determiningthe-optimal-number-of-clusters-3-must-know-methods/

set.seed(1234)

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans <- fviz_nbclust(dtm.tfidf.features.reducedby.tfidf.matrix, kmeans, method = "gap_stat", nboot = cluster.eval.nboot, nstart = 25, k.max = cluster.eval.max.cnt) 

dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans <- dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Gap statistic method; dtm.tfidf.features.reducedby.tfidf; kmeans; gap statistic")

dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans.clust_cnt <- 4

```

### for dtm.tf.features.reducedby.rst
```{r}
set.seed(1234)

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans <- fviz_nbclust(dtm.tf.features.reducedby.rst.matrix, kmeans, method = "gap_stat", k.max = cluster.eval.max.cnt, nboot = cluster.eval.nboot) 

dtm.tf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans <- dtm.tf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Gap statistic method; dtm.tf.features.reducedby.rst; kmeans; gap statistic")

dtm.tf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans.clust_cnt <- 12

```

### for dtm.tfidf.features.reducedby.rst
```{r}
set.seed(1234)

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans <- fviz_nbclust(dtm.tfidf.features.reducedby.rst.matrix, kmeans, method = "gap_stat", k.max = cluster.eval.max.cnt, nboot = cluster.eval.nboot) 

dtm.tfidf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans <- dtm.tfidf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Gap statistic method; dtm.tfidf.features.reducedby.rst; kmeans; gap statistic")

dtm.tfidf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans.clust_cnt <- NA

```


## evaluate the cluster count with the gap statistic method, clusGap function, kmedoids
### for dtm.tf.features.reducedby.tfidf
```{r}
# estimate the number of cluster - gap statistic method kmedoids-pam
# references:
# https://stackoverflow.com/questions/65799784/find-the-number-of-clusters-using-clusgap-function-in-r
# https://stat.ethz.ch/R-manual/R-devel/library/cluster/html/clusGap.html
# https://rpubs.com/vsagar19/clustering

set.seed(1234)
cluster.cnt.ex_ante <- 3

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.tfidf.clusGapStat.pam <- clusGap(dtm.tf.features.reducedby.tfidf.matrix, FUN = pam, nstart = 25, K.max = cluster.eval.max.cnt, B = 10)

dtm.tf.features.reducedby.tfidf.clusGapStat.pam.ggplot <- fviz_gap_stat(dtm.tf.features.reducedby.tfidf.clusGapStat.pam)
dtm.tf.features.reducedby.tfidf.clusGapStat.pam.ggplot <- dtm.tf.features.reducedby.tfidf.clusGapStat.pam.ggplot +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Gap statistic method; dtm.tf.features.reducedby.tfidf; kmedoids/pam; gap statistic")

dtm.tf.features.reducedby.tfidf.clusGapStat.pam.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.tfidf.clusGapStat.pam.ggplot_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.tfidf.clusGapStat.pam.ggplot, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.tfidf.clusGapStat.pam.clust_cnt <- 3

```

### for dtm.tfidf.features.reducedby.tfidf
```{r}
# estimate the number of cluster - gap statistic method kmedoids-pam
# https://stackoverflow.com/questions/65799784/find-the-number-of-clusters-using-clusgap-function-in-r
# https://stat.ethz.ch/R-manual/R-devel/library/cluster/html/clusGap.html
# https://rpubs.com/vsagar19/clustering

set.seed(1234)

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.tfidf.clusGapStat.pam <- clusGap(dtm.tfidf.features.reducedby.tfidf.matrix, FUN = pam, nstart = 25, K.max = cluster.eval.max.cnt, B = 10)

dtm.tfidf.features.reducedby.tfidf.clusGapStat.pam.ggplot <- fviz_gap_stat(dtm.tfidf.features.reducedby.tfidf.clusGapStat.pam)
dtm.tfidf.features.reducedby.tfidf.clusGapStat.pam.ggplot <- dtm.tfidf.features.reducedby.tfidf.clusGapStat.pam.ggplot +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Gap statistic method; dtm.tfidf.features.reducedby.tfidf; kmedoids/pam; gap statistic")

dtm.tfidf.features.reducedby.tfidf.clusGapStat.pam.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.tfidf.clusGapStat.pam.ggplot_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.tfidf.clusGapStat.pam.ggplot, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.tfidf.clusGapStat.pam.clust_cnt <- 5

```

### for dtm.tf.features.reducedby.rst
```{r}
set.seed(1234)

dtm.tf.features.reducedby.rst.clusGapStat.pam <- clusGap(dtm.tf.features.reducedby.rst.matrix, FUN = pam, nstart = 25, K.max = cluster.eval.max.cnt, B = 10)

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.rst.clusGapStat.pam.ggplot <- fviz_gap_stat(dtm.tf.features.reducedby.rst.clusGapStat.pam)

dtm.tf.features.reducedby.rst.clusGapStat.pam.ggplot <- dtm.tf.features.reducedby.rst.clusGapStat.pam.ggplot +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Gap statistic method; dtm.tf.features.reducedby.rst; kmedoids/pam; gap statistic")

dtm.tf.features.reducedby.rst.clusGapStat.pam.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.rst.clusGapStat.pam.ggplot_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.rst.clusGapStat.pam.ggplot, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.rst.clusGapStat.pam.clust_cnt <- 6
```

### for dtm.tfidf.features.reducedby.rst
```{r}
set.seed(1234)

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.rst.clusGapStat.pam <- clusGap(dtm.tfidf.features.reducedby.rst.matrix, FUN = pam, nstart = 25, K.max = cluster.eval.max.cnt, B = 10)

# print(dtm.tf.features.reducedby.rst.clusGapStat, method = "firstmax")

dtm.tfidf.features.reducedby.rst.clusGapStat.pam.ggplot <- fviz_gap_stat(dtm.tfidf.features.reducedby.rst.clusGapStat.pam)

dtm.tfidf.features.reducedby.rst.clusGapStat.pam.ggplot <- dtm.tfidf.features.reducedby.rst.clusGapStat.pam.ggplot +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Gap statistic method; dtm.tfidf.features.reducedby.rst; kmedoids/pam; gap statistic")

dtm.tfidf.features.reducedby.rst.clusGapStat.pam.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.rst.clusGapStat.pam.ggplot_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.rst.clusGapStat.pam.ggplot, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.rst.clusGapStat.pam.clust_cnt <- NA
```

## evaluate the cluster count with the gap statistic method, clusGap function, hierarchical clustering
### for dtm.tf.features.reducedby.tfidf
```{r}
# estimate the number of cluster - gap statistic method hierarchical clustering
set.seed(1234)

dtm.tf.features.reducedby.tfidf.clusGap.hcut <- clusGap(dtm.tf.features.reducedby.tfidf.matrix, FUN = hcut, K.max = cluster.eval.max.cnt, B = 10)

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.tfidf.clusGap.hcut.ggplot <- fviz_gap_stat(dtm.tf.features.reducedby.tfidf.clusGap.hcut)

dtm.tf.features.reducedby.tfidf.clusGap.hcut.ggplot <- dtm.tf.features.reducedby.tfidf.clusGap.hcut.ggplot +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Hierarchical clustering; dtm.tf.features.reducedby.tfidf")

dtm.tf.features.reducedby.tfidf.clusGap.hcut.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.tfidf.clusGap.hcut.ggplot_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.tfidf.clusGap.hcut.ggplot, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.tfidf.clusGap.hcut.ggplot.clust_cnt <- 3

```

### for dtm.tf.features.reducedby.rst
```{r}
# estimate the number of cluster - gap statistic method hierarchical clustering
set.seed(1234)

dtm.tf.features.reducedby.rst.clusGap.hcut <- clusGap(dtm.tf.features.reducedby.rst.matrix, FUN = hcut, K.max = cluster.eval.max.cnt, B = 10)

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.rst.clusGap.hcut.ggplot <- fviz_gap_stat(dtm.tf.features.reducedby.rst.clusGap.hcut)

dtm.tf.features.reducedby.rst.clusGap.hcut.ggplot <- dtm.tf.features.reducedby.rst.clusGap.hcut.ggplot +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Hierarchical clustering; dtm.tf.features.reducedby.rst")

dtm.tf.features.reducedby.rst.clusGap.hcut.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.rst.clusGap.hcut.ggplot_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.rst.clusGap.hcut.ggplot, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.rst.clusGap.hcut.ggplot.clust_cnt <- 2

```

### for dtm.tfidf.features.reducedby.tfidf
```{r}
# estimate the number of cluster - gap statistic method hierarchical clustering
set.seed(1234)

dtm.tfidf.features.reducedby.tfidf.clusGap.hcut <- clusGap(dtm.tfidf.features.reducedby.tfidf.matrix, FUN = hcut, K.max = cluster.eval.max.cnt, B = 10)

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.tfidf.clusGap.hcut.ggplot <- fviz_gap_stat(dtm.tfidf.features.reducedby.tfidf.clusGap.hcut)

dtm.tfidf.features.reducedby.tfidf.clusGap.hcut.ggplot <- dtm.tfidf.features.reducedby.tfidf.clusGap.hcut.ggplot +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Hierarchical clustering; dtm.tf.features.reducedby.tfidf")

dtm.tfidf.features.reducedby.tfidf.clusGap.hcut.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.tfidf.clusGap.hcut.ggplot_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.tfidf.clusGap.hcut.ggplot, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.tfidf.clusGap.hcut.ggplot.clust_cnt <- 5

```

### for dtm.tfidf.features.reducedby.rst
```{r}
# estimate the number of cluster - gap statistic method hierarchical clustering
set.seed(1234)

dtm.tfidf.features.reducedby.rst.clusGap.hcut <- clusGap(dtm.tfidf.features.reducedby.rst.matrix, FUN = hcut, K.max = cluster.eval.max.cnt, B = 10)

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.rst.clusGap.hcut.ggplot <- fviz_gap_stat(dtm.tfidf.features.reducedby.rst.clusGap.hcut)

dtm.tfidf.features.reducedby.rst.clusGap.hcut.ggplot <- dtm.tfidf.features.reducedby.rst.clusGap.hcut.ggplot +labs(title = "Evaluation of the optimal number of clusters", subtitle = "Hierarchical clustering; dtm.tfidf.features.reducedby.rst")

dtm.tfidf.features.reducedby.rst.clusGap.hcut.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.rst.clusGap.hcut.ggplot_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.rst.clusGap.hcut.ggplot, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.rst.clusGap.hcut.ggplot.clust_cnt <- NA

```

## evaluate the cluster count with the NbClust package, euclidean distance, kmeans
### for dtm.tf.features.reducedby.tfidf
```{r}
set.seed(1234)
max.nc <- cluster.eval.max.cnt

dtm.tf.features.reducedby.tfidf.NbClust.euclidean.kmeans <- NbClust(dtm.tf.features.reducedby.tfidf.matrix, diss = NULL, distance = "euclidean", min.nc = 2, max.nc, method = "kmeans")

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.tfidf.NbClust.euclidean.kmeans.histogram <- ggplot(as.data.frame(dtm.tf.features.reducedby.tfidf.NbClust.euclidean.kmeans$Best.nc[1,]), aes(x=dtm.tf.features.reducedby.tfidf.NbClust.euclidean.kmeans$Best.nc[1, ])) +geom_histogram(binwidth = 0.5) +scale_x_continuous(breaks = seq(0,max.nc,by=1)) +scale_y_continuous(breaks = seq(0,10,by=1)) +ggtitle("Evaluation of the optimal number of clusters", subtitle = "NbClust package; dtm.tf.features.reducedby.tfidf; euclidean distance; kmeans") +ylab("amount of indices proposing best number of clusters") +xlab("proposed best number of Clusters k")

dtm.tf.features.reducedby.tfidf.NbClust.euclidean.kmeans.histogram

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.tfidf.NbClust.euclidean.kmeans.histogram_",cv,".png", sep = ""), plot = dtm.tf.features.reducedby.tfidf.NbClust.euclidean.kmeans.histogram, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tf.features.reducedby.tfidf.NbClust.euclidean.kmeans.clust_cnt <- 2
```

### for dtm.tf.features.reducedby.rst
```{r}
# the function call produces an error, therefore set to NA
dtm.tf.features.reducedby.rst.NbClust.euclidean.kmeans.clust_cnt <- NA
```

### for dtm.tfidf.features.reducedby.tfidf
```{r}
set.seed(1234)
max.nc <- cluster.eval.max.cnt

dtm.tfidf.features.reducedby.tfidf.NbClust.euclidean.kmeans <- NbClust(dtm.tfidf.features.reducedby.tfidf.matrix, diss = NULL, distance = "euclidean", min.nc = 2, max.nc, method = "kmeans")

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.tfidf.NbClust.euclidean.kmeans.histogram <- ggplot(as.data.frame(dtm.tfidf.features.reducedby.tfidf.NbClust.euclidean.kmeans$Best.nc[1,]), aes(x=dtm.tfidf.features.reducedby.tfidf.NbClust.euclidean.kmeans$Best.nc[1, ])) +geom_histogram(binwidth = 0.5) +scale_x_continuous(breaks = seq(0,max.nc,by=1)) +scale_y_continuous(breaks = seq(0,10,by=1)) +ggtitle("Evaluation of the optimal number of clusters", subtitle = "NbClust package; dtm.tfidf.features.reducedby.tfidf; euclidean distance; kmeans") +ylab("amount of indices proposing best number of clusters") +xlab("proposed best number of clusters")

dtm.tfidf.features.reducedby.tfidf.NbClust.euclidean.kmeans.histogram

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.tfidf.NbClust.euclidean.kmeans.histogram_",cv,".png", sep = ""), plot = dtm.tfidf.features.reducedby.tfidf.NbClust.euclidean.kmeans.histogram, dpi = 300)

# define the optimal cluster count by visual interpretation
dtm.tfidf.features.reducedby.tfidf.NbClust.euclidean.kmeans.clust_cnt <- 3
```

### for dtm.tfidf.features.reducedby.rst (failure)
```{r}
# the function call produces an error, therefore set to NA
dtm.tfidf.features.reducedby.rst.NbClust.euclidean.kmeans.clust_cnt <- NA
```

## gather all results from the evaluation of the optimal number of clusters
```{r}
dtm.tf.features.reducedby.tfidf.cluster.eval.results <- data.frame(tf_tfidf = c( dtm.tf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss.clust_cnt, dtm.tf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans.wss.clust_cnt, dtm.tf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans.clust_cnt, dtm.tf.features.reducedby.tfidf.clusGapStat.pam.clust_cnt, dtm.tf.features.reducedby.tfidf.clusGap.hcut.ggplot.clust_cnt, dtm.tf.features.reducedby.tfidf.NbClust.euclidean.kmeans.clust_cnt))

dtm.tf.features.reducedby.rst.cluster.eval.results <- data.frame(tf_rst = c( dtm.tf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss.clust_cnt, dtm.tf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans.wss.clust_cnt, dtm.tf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans.clust_cnt, dtm.tf.features.reducedby.rst.clusGapStat.pam.clust_cnt, dtm.tf.features.reducedby.rst.clusGap.hcut.ggplot.clust_cnt, dtm.tf.features.reducedby.rst.NbClust.euclidean.kmeans.clust_cnt))

dtm.tfidf.features.reducedby.tfidf.cluster.eval.results <- data.frame(tfidf_tfidf = c( dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.elbow.kmeans.wss.clust_cnt, dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.silhouette.kmeans.wss.clust_cnt, dtm.tfidf.features.reducedby.tfidf.fviz_nbclust.gapstat.kmeans.clust_cnt, dtm.tfidf.features.reducedby.tfidf.clusGapStat.pam.clust_cnt, dtm.tfidf.features.reducedby.tfidf.clusGap.hcut.ggplot.clust_cnt, dtm.tfidf.features.reducedby.tfidf.NbClust.euclidean.kmeans.clust_cnt))
  
dtm.tfidf.features.reducedby.rst.cluster.eval.results <- data.frame(tfidf_rst = c( dtm.tfidf.features.reducedby.rst.fviz_nbclust.elbow.kmeans.wss.clust_cnt, dtm.tfidf.features.reducedby.rst.fviz_nbclust.silhouette.kmeans.wss.clust_cnt, dtm.tfidf.features.reducedby.rst.fviz_nbclust.gapstat.kmeans.clust_cnt, dtm.tfidf.features.reducedby.rst.clusGapStat.pam.clust_cnt, dtm.tfidf.features.reducedby.rst.clusGap.hcut.ggplot.clust_cnt, dtm.tfidf.features.reducedby.rst.NbClust.euclidean.kmeans.clust_cnt))

dtm.cluster.eval.results <- cbind(dtm.tf.features.reducedby.tfidf.cluster.eval.results,dtm.tf.features.reducedby.rst.cluster.eval.results,dtm.tfidf.features.reducedby.tfidf.cluster.eval.results,dtm.tfidf.features.reducedby.rst.cluster.eval.results)

# UC.06 Informationen visualisieren
row.names(dtm.cluster.eval.results) <- c("elbow.kmeans.wss","silhouette.kmeans.wss","gapstat.kmeans","clusGapStat.kmedoids","clusGap.hcut","NbClust.euclidean.kmeans")
dtm.cluster.eval.results.summary.list <- apply(dtm.cluster.eval.results,1,summary)
dtm.cluster.eval.results.summary.df <- as.data.frame(do.call(rbind, dtm.cluster.eval.results.summary.list))
dtm.cluster.eval.results
summary(t(dtm.cluster.eval.results))

# UC.07 Informationen austauschen
uc03_xlsx_list <- append(uc03_xlsx_list, list(cluster.eval.results = dtm.cluster.eval.results))
uc07_data(dtm.cluster.eval.results,"xlsx",F)
# write.xlsx(dtm.cluster.eval.results, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.cluster.eval.results_",cv,".xlsx", sep=""))

uc03_xlsx_list <- append(uc03_xlsx_list, list(cluster.eval.results.summary = dtm.cluster.eval.results.summary.df))
uc07_data(dtm.cluster.eval.results.summary.df,"xlsx",F)
# write.xlsx(dtm.cluster.eval.results.summary.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.cluster.eval.results.summary_",cv,".xlsx", sep=""))

```

## global function to store ggplots
```{r}
uc07_ggplot <- function(ggobject) {
  file_name <- as.character(substitute(ggobject))
  ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/",file_name,"_",cv,cc,".png", sep = ""), plot = ggobject, dpi = 300)
}
```

## manual definition of the optimal cluster count by result interpretation
```{r}
# set the overall cluster count
cluster.cnt.overall <- 2
cc <- cluster.cnt.overall

# cosine similarity
tdm.tf.features.reducedby.cosine.sim.dist.hclust.cluster.cnt <- cluster.cnt.overall

tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.cluster_cnt <- tdm.tf.features.reducedby.cosine.sim.dist.hclust.cluster.cnt
tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.cluster_cnt <- tdm.tf.features.reducedby.cosine.sim.dist.hclust.cluster.cnt
tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.cluster_cnt <- tdm.tf.features.reducedby.cosine.sim.dist.hclust.cluster.cnt
tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.cluster_cnt <- tdm.tf.features.reducedby.cosine.sim.dist.hclust.cluster.cnt

# kmeans

dtm.tf.features.reducedby.kmeans.cluster.cnt <- cluster.cnt.overall

dtm.tf.features.reducedby.tfidf.matrix.df.kmeans.cluster_cnt <- dtm.tf.features.reducedby.kmeans.cluster.cnt
dtm.tf.features.reducedby.rst.matrix.df.kmeans.cluster_cnt <- dtm.tf.features.reducedby.kmeans.cluster.cnt
dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans.cluster_cnt <- dtm.tf.features.reducedby.kmeans.cluster.cnt
dtm.tfidf.features.reducedby.rst.matrix.df.kmeans.cluster_cnt <- dtm.tf.features.reducedby.kmeans.cluster.cnt

# kmedoids

dtm.tf.features.reducedby.kmedoids.cluster.cnt <- cluster.cnt.overall

dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids.cluster_cnt <- dtm.tf.features.reducedby.kmedoids.cluster.cnt
dtm.tf.features.reducedby.rst.matrix.df.kmedoids.cluster_cnt <- dtm.tf.features.reducedby.kmedoids.cluster.cnt
dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids.cluster_cnt <- dtm.tf.features.reducedby.kmedoids.cluster.cnt
dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids.cluster_cnt <- dtm.tf.features.reducedby.kmedoids.cluster.cnt

# lsa, kmeans

tdm.tf.features.reducedby.myLSAspace.kmeans.cluster_cnt <- cluster.cnt.overall

tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans.cluster_cnt <- tdm.tf.features.reducedby.myLSAspace.kmeans.cluster_cnt
tdm.tf.features.reducedby.rst.myLSAspace.kmeans.cluster_cnt <- tdm.tf.features.reducedby.myLSAspace.kmeans.cluster_cnt
tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans.cluster_cnt <- tdm.tf.features.reducedby.myLSAspace.kmeans.cluster_cnt
tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans.cluster_cnt <- tdm.tf.features.reducedby.myLSAspace.kmeans.cluster_cnt

# lsa, cosine

tdm.tf.features.reducedby.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt <- cluster.cnt.overall

tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt <- tdm.tf.features.reducedby.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt
tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt <- tdm.tf.features.reducedby.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt
tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt <- tdm.tf.features.reducedby.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt
tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt <- tdm.tf.features.reducedby.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt

# set the color palette for the fviz_dend function
fviz_dend.color.palette = c("black","blue")
```

## save the xlsx files
```{r}
uc03_wb = createWorkbook(type = "xlsx")

for (item in 1:length(uc03_xlsx_list)) {
  sheet = createSheet(uc03_wb, sheetName = names(uc03_xlsx_list)[item])
  addDataFrame(as.data.frame(uc03_xlsx_list[[item]]), sheet = sheet)
}

saveWorkbook(uc03_wb,paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/uc03_wb_",cv,".xlsx", sep=""))

```


# UC.04 Zusammenhangs-Analyse durchführen
## definition area
### a list to store all UC.03 related xlsx based data
```{r}
uc04_xlsx_list <- list()
```

## hierachical clustering with cosine similarity 
### for tdm.tf.features.reducedby.tfidf
```{r}
# clustering of the tdm.tf.matrix.cosine.sim.cluster with hierarchical clustering
# https://cran.r-project.org/web/packages/textmineR/vignettes/b_document_clustering.html

tdm.tf.features.reducedby.tfidf.cosine.sim <- cosine(tdm.tf.features.reducedby.tfidf.matrix)
tdm.tf.features.reducedby.tfidf.cosine.sim[is.na(tdm.tf.features.reducedby.tfidf.cosine.sim)] <- 0
tdm.tf.features.reducedby.tfidf.cosine.sim.dist <- dist(tdm.tf.features.reducedby.tfidf.cosine.sim)
tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust <- hclust(tdm.tf.features.reducedby.tfidf.cosine.sim.dist, method = "ward.D")

# UC.06 Informationen visualisieren
p <- plot(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust)
tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc <- rect.hclust(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust, k = tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.cluster_cnt, border = "red")

tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot <- fviz_dend(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust, rect_lty = 1, lwd = 0.2, rect = T , k = tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.cluster_cnt, cex = 0.2, ggtheme = theme_classic(), palette = fviz_dend.color.palette)

tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot <- tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot +ggtitle("Determination of cluster members", subtitle = paste("Cluster dendrogram; tdm.tf.features.reducedby.tfidf; cosine distance; ward.D; k =", tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.cluster_cnt)) +xlab("Documents in the Corpus")

tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot

# UC.07 Informationen austauschen
uc07_ggplot(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot)

```

#### retrieve the cosine based cluster allocation for tdm.tf.features.reducedby.tfidf
```{r}
# UC.07 Informationen austauschen
tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df <- data.frame()

for (clusterno in 1:length(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc)) {
  df.temp <- as.data.frame(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc[[clusterno]])
  df1.temp <- data.frame(rep(clusterno,times=length(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc[[clusterno]])))
  df.temp <- cbind(df.temp,df1.temp)
  colnames(df.temp) <- c("corpus_item","cluster_number")
  tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df <- rbind(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df,df.temp)
}

uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tf_tfidf.cos = tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df))
uc07_data(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df,"xlsx")
# write.xlsx(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df_",cv,cc,".xlsx", sep=""))
```

### for tdm.tf.features.reducedby.rst
```{r}
tdm.tf.matrix.cosine.sim.rst <- cosine(tdm.tf.features.reducedby.rst.matrix)
tdm.tf.features.reducedby.rst.cosine.sim <- cosine(tdm.tf.features.reducedby.rst.matrix)
tdm.tf.features.reducedby.rst.cosine.sim.dist <- as.dist(tdm.tf.features.reducedby.rst.cosine.sim)
tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust <- hclust(tdm.tf.features.reducedby.rst.cosine.sim.dist, method = "ward.D")

# UC.06 Informationen visualisieren
p <- plot(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust)
tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc <- rect.hclust(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust, k = tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.cluster_cnt, border = "red")

tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot <- fviz_dend(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust, rect_lty = 1, lwd = 0.2, rect = T , k = tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.cluster_cnt, cex = 0.2, ggtheme = theme_classic(), palette = fviz_dend.color.palette)

tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot <- tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot +ggtitle("Determination of cluster members", subtitle = paste("Cluster dendrogram; tdm.tf.features.reducedby.rst; cosine distance; ward.D; k =", tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.cluster_cnt)) +xlab("Documents in the Corpus") +ylim(-0.1,1)

tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot

# UC.07 Informationen austauschen
uc07_ggplot(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot)

```
#### retrieve the cosine based cluster allocation for tdm.tf.features.reducedby.rst
```{r}
tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df <- data.frame()

for (clusterno in 1:length(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc)) {
  df.temp <- as.data.frame(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc[[clusterno]])
  df1.temp <- data.frame(rep(clusterno,times=length(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc[[clusterno]])))
  df.temp <- cbind(df.temp,df1.temp)
  colnames(df.temp) <- c("corpus_item","cluster_number")
  tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df <- rbind(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df,df.temp)
}

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tf_rst.cos = tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df))
uc07_data(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df,"xlsx")
# write.xlsx(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df_",cv,cc,".xlsx", sep=""))
```

### for tdm.tfidf.features.reducedby.tfidf and tdm.tfidf.features.reducedby.rst
```{r}
# calculate cosine distance of tfidf matrix
tdm.tfidf.features.reducedby.tfidf.cosine.sim <- cosine(tdm.tfidf.features.reducedby.tfidf.matrix)
tdm.tfidf.features.reducedby.rst.cosine.sim <- cosine(tdm.tfidf.features.reducedby.rst.matrix)

tdm.tfidf.features.reducedby.tfidf.cosine.sim <- cosine(tdm.tfidf.features.reducedby.tfidf.matrix)
tdm.tfidf.features.reducedby.tfidf.cosine.sim[is.na(tdm.tfidf.features.reducedby.tfidf.cosine.sim)] <- 0

tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist <- as.dist(tdm.tfidf.features.reducedby.tfidf.cosine.sim)
tdm.tfidf.features.reducedby.rst.cosine.sim.dist <- as.dist(tdm.tfidf.features.reducedby.rst.cosine.sim)

tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust <- hclust(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist, method = "ward.D")

# UC.06 Informationen visualisieren
p <- plot(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust)
tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc <- rect.hclust(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust, k = tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.cluster_cnt, border = "red")

tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust <- hclust(tdm.tfidf.features.reducedby.rst.cosine.sim.dist, method = "ward.D")

p <- plot(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust)
tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc <- rect.hclust(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust, k = tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.cluster_cnt, border = "red")

# UC.06 Informationen visualisieren
tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot <- fviz_dend(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust, rect_lty = 1, lwd = 0.2, rect = T , k = tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.cluster_cnt, cex = 0.2, ggtheme = theme_classic(), palette = fviz_dend.color.palette)

tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot <- tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot +ggtitle("Determination of cluster members", subtitle = paste("Cluster dendrogram; tdm.tfidf.features.reducedby.tfidf; cosine distance; ward.D; k =", tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.cluster_cnt)) +xlab("Documents in the Corpus") +ylim(-0.1,1)

tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot

# UC.07 Informationen austauschen

ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot_",cv,cc,".png", sep = ""), plot = tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.ggplot, dpi = 300)

# UC.06 Informationen visualisieren
tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot <- fviz_dend(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust, rect_lty = 1, lwd = 0.2, rect = T , k = tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.cluster_cnt, cex = 0.2, ggtheme = theme_classic(), palette = fviz_dend.color.palette)

tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot <- tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot +ggtitle("Determination of cluster members", subtitle = paste("Cluster dendrogram; tdm.tfidf.features.reducedby.rst; cosine distance; ward.D; k =", tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.cluster_cnt)) +xlab("Documents in the Corpus") +ylim(-0.1,1)

tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot_",cv,cc,".png",sep = ""), plot = tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.ggplot, dpi = 300)

```
#### retrieve the cosine based cluster allocation for tdm.tfidf.features.reducedby.tfidf
```{r}
tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df <- data.frame()

for (clusterno in 1:length(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc)) {
  df.temp <- as.data.frame(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc[[clusterno]])
  df1.temp <- data.frame(rep(clusterno,times=length(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc[[clusterno]])))
  df.temp <- cbind(df.temp,df1.temp)
  colnames(df.temp) <- c("corpus_item","cluster_number")
  tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df <- rbind(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df,df.temp)
}

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tfidf_tfidf.cos = tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df))
uc07_data(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df,"xlsx")
# write.xlsx(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df_",cv,cc,".xlsx", sep=""))
```

#### retrieve the cosine based cluster allocation for tdm.tfidf.features.reducedby.rst
```{r}
tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df <- data.frame()

for (clusterno in 1:length(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc)) {
  df.temp <- as.data.frame(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc[[clusterno]])
  df1.temp <- data.frame(rep(clusterno,times=length(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc[[clusterno]])))
  df.temp <- cbind(df.temp,df1.temp)
  colnames(df.temp) <- c("corpus_item","cluster_number")
  tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df <- rbind(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df,df.temp)
}

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tfidf_rst.cos = tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df))
uc07_data(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df,"xlsx")
# write.xlsx(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df_",cv,cc,".xlsx", sep=""))
```

### build a dataframe containing all the cosine similarity results
```{r}
tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df <- tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df[order(row.names(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df)),]

tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df <- tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df[order(row.names(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df)),]

tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df <- tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df[order(row.names(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df)),]

tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df <- tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df[order(row.names(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df)),]

cosine.sim.dist.hclust.alloc.df.combined <- data.frame(subset(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df, select = c("cluster_number")))
cosine.sim.dist.hclust.alloc.df.combined <- cbind(cosine.sim.dist.hclust.alloc.df.combined,subset(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df, select = c("cluster_number")))
cosine.sim.dist.hclust.alloc.df.combined <- cbind(cosine.sim.dist.hclust.alloc.df.combined,subset(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df, select = c("cluster_number")))
cosine.sim.dist.hclust.alloc.df.combined <- cbind(cosine.sim.dist.hclust.alloc.df.combined,subset(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df, select = c("cluster_number")))
colnames(cosine.sim.dist.hclust.alloc.df.combined) <- c("tf_tfidf","tf_rst","tfidf_tfidf","tfidf_rst")

# UC.06 Informationen visualisieren
head(cosine.sim.dist.hclust.alloc.df.combined)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(cosine = cosine.sim.dist.hclust.alloc.df.combined))
uc07_data(cosine.sim.dist.hclust.alloc.df.combined,"xlsx")
# write.xlsx(cosine.sim.dist.hclust.alloc.df.combined, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/cosine.sim.dist.hclust.alloc.df.combined_",cv,cc,".xlsx", sep=""))

```

## clustering based upon k-means
### for dtm.tf.features.reducedby.tfidf and dtm.tf.features.reducedby.rst
```{r}
set.seed(1234)

#
dtm.tf.features.reducedby.tfidf.matrix.df.kmeans <- kmeans(dtm.tf.features.reducedby.tfidf.matrix.df, dtm.tf.features.reducedby.tfidf.matrix.df.kmeans.cluster_cnt, nstart = 25)

dtm.tf.features.reducedby.rst.matrix.df.kmeans <- kmeans(dtm.tf.features.reducedby.rst.matrix.df, dtm.tf.features.reducedby.rst.matrix.df.kmeans.cluster_cnt, nstart = 25)

# 
dtm.tf.features.reducedby.tfidf.kmeans.cluster.stats <- aggregate(dtm.tf.features.reducedby.tfidf.matrix.df, by = list(cluster = dtm.tf.features.reducedby.tfidf.matrix.df.kmeans$cluster), mean)
head(dtm.tf.features.reducedby.tfidf.kmeans.cluster.stats)

dtm.tf.features.reducedby.tfidf.kmeans.clusters <- cbind(dtm.tf.features.reducedby.tfidf.matrix.df, cluster = dtm.tf.features.reducedby.tfidf.matrix.df.kmeans$cluster)
head(dtm.tf.features.reducedby.tfidf.kmeans.clusters)

dtm.tf.features.reducedby.rst.kmeans.cluster.stats <- aggregate(dtm.tf.features.reducedby.rst.matrix.df, by = list(cluster = dtm.tf.features.reducedby.rst.matrix.df.kmeans$cluster), mean)

# commented due to large size
# head(dtm.tf.features.reducedby.rst.kmeans.cluster.stats)

dtm.tf.features.reducedby.rst.kmeans.clusters <- cbind(dtm.tf.features.reducedby.rst.matrix.df, cluster = dtm.tf.features.reducedby.rst.matrix.df.kmeans$cluster)

# commented due to huge size
#head(dtm.tf.features.reducedby.rst.kmeans.clusters)

```

#### visualisation for dtm.tf.features.reducedby.tfidf.kmeans.cluster.plot
```{r,fig.width=40, fig.height=15}
# UC.06 Information visualisieren
dtm.tf.features.reducedby.tfidf.kmeans.cluster.plot <- fviz_cluster(dtm.tf.features.reducedby.tfidf.matrix.df.kmeans, dtm.tf.features.reducedby.tfidf.matrix.df) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tf.features.reducedby.tfidf; kmeans; k =", dtm.tf.features.reducedby.tfidf.matrix.df.kmeans.cluster_cnt))

dtm.tf.features.reducedby.tfidf.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.tfidf.kmeans.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = dtm.tf.features.reducedby.tfidf.kmeans.cluster.plot)

```

#### visualisation for dtm.tf.features.reducedby.rst.kmeans.cluster.plot
```{r,fig.width=40, fig.height=20}
# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.rst.kmeans.cluster.plot <- fviz_cluster(dtm.tf.features.reducedby.rst.matrix.df.kmeans, dtm.tf.features.reducedby.rst.matrix.df) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tf.features.reducedby.rst; kmeans; k =", dtm.tf.features.reducedby.rst.matrix.df.kmeans.cluster_cnt))

dtm.tf.features.reducedby.rst.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.rst.kmeans.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = dtm.tf.features.reducedby.rst.kmeans.cluster.plot, limitsize = F)

```

### for dtm.tfidf.features.reducedby.tfidf and dtm.tfidf.features.reducedby.rst
```{r}
# calculation section
set.seed(1234)
dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans <- kmeans(dtm.tfidf.features.reducedby.tfidf.matrix.df, dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans.cluster_cnt, nstart = 25)

dtm.tfidf.features.reducedby.rst.matrix.df.kmeans <- kmeans(dtm.tfidf.features.reducedby.rst.matrix.df, dtm.tfidf.features.reducedby.rst.matrix.df.kmeans.cluster_cnt, nstart = 25)

#
dtm.tfidf.features.reducedby.tfidf.kmeans.cluster.stats <- aggregate(dtm.tfidf.features.reducedby.tfidf.matrix.df, by = list(cluster = dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans$cluster), mean)
head(dtm.tfidf.features.reducedby.tfidf.kmeans.cluster.stats)

dtm.tfidf.features.reducedby.tfidf.kmeans.clusters <- cbind(dtm.tfidf.features.reducedby.tfidf.matrix.df, cluster = dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans$cluster)
head(dtm.tfidf.features.reducedby.tfidf.kmeans.clusters)

dtm.tfidf.features.reducedby.rst.kmeans.cluster.stats <- aggregate(dtm.tfidf.features.reducedby.rst.matrix.df, by = list(cluster = dtm.tfidf.features.reducedby.rst.matrix.df.kmeans$cluster), mean)
# commented due to huge size
# head(dtm.tfidf.features.reducedby.rst.kmeans.cluster.stats)

dtm.tfidf.features.reducedby.rst.kmeans.clusters <- cbind(dtm.tfidf.features.reducedby.rst.matrix.df, cluster = dtm.tfidf.features.reducedby.rst.matrix.df.kmeans$cluster)
# commented due to huge size
# head(dtm.tfidf.features.reducedby.rst.kmeans.clusters)

```

#### visualisation for dtm.tfidf.features.reducedby.tfidf.kmeans.cluster.plot
```{r,fig.width=40, fig.height=20}
# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.tfidf.kmeans.cluster.plot <- fviz_cluster(dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans, dtm.tfidf.features.reducedby.tfidf.matrix.df) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tfidf.features.reducedby.tfidf; kmeans; k =", dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans.cluster_cnt))

dtm.tfidf.features.reducedby.tfidf.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.tfidf.kmeans.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = dtm.tfidf.features.reducedby.tfidf.kmeans.cluster.plot)

```

#### visualisation for dtm.tfidf.features.reducedby.rst.kmeans.cluster.plot
```{r,fig.width=40, fig.height=20}
# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.rst.kmeans.cluster.plot <- fviz_cluster(dtm.tfidf.features.reducedby.rst.matrix.df.kmeans, dtm.tfidf.features.reducedby.rst.matrix.df) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tfidf.features.reducedby.rst; kmeans; k =", dtm.tfidf.features.reducedby.rst.matrix.df.kmeans.cluster_cnt))

dtm.tfidf.features.reducedby.rst.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.rst.kmeans.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = dtm.tfidf.features.reducedby.rst.kmeans.cluster.plot, limitsize = F)

```

## retrieve all the cluster allocations
```{r}
kmeans.cluster.alloc.combined <- data.frame(dtm.tf.features.reducedby.tfidf.matrix.df.kmeans$cluster)
kmeans.cluster.alloc.combined <- cbind(kmeans.cluster.alloc.combined, dtm.tf.features.reducedby.rst.matrix.df.kmeans$cluster)
kmeans.cluster.alloc.combined <- cbind(kmeans.cluster.alloc.combined, dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans$cluster)
kmeans.cluster.alloc.combined <- cbind(kmeans.cluster.alloc.combined, dtm.tfidf.features.reducedby.rst.matrix.df.kmeans$cluster)
colnames(kmeans.cluster.alloc.combined) <- c("tf_tfidf","tf_rst","tfidf_ifidf","tfidf_rst")

# UC.06 Informationen visualisieren
head(kmeans.cluster.alloc.combined)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(kmeans = kmeans.cluster.alloc.combined))
uc07_data(kmeans.cluster.alloc.combined,"xlsx")
# write.xlsx(kmeans.cluster.alloc.combined, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/kmeans.cluster.alloc.combined_",cv,cc,".xlsx", sep=""))
```

## clustering based on kmedoids-pam
### for dtm.tf.features.reducedby.tfidf and dtm.tf.features.reducedby.rst
```{r}
# calculation section
set.seed(1234)

dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids <- pam(dtm.tf.features.reducedby.tfidf.matrix.df, dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids.cluster_cnt, nstart = 25)

#
dtm.tf.features.reducedby.rst.matrix.df.kmedoids <- pam(dtm.tf.features.reducedby.rst.matrix.df, dtm.tf.features.reducedby.rst.matrix.df.kmedoids.cluster_cnt, nstart = 25)

#
dtm.tf.features.reducedby.tfidf.kmedoids.cluster.stats <- aggregate(dtm.tf.features.reducedby.tfidf.matrix.df, by = list(cluster = dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids$cluster), mean)
head(dtm.tf.features.reducedby.tfidf.kmedoids.cluster.stats)

dtm.tf.features.reducedby.tfidf.kmedoids.clusters <- cbind(dtm.tf.features.reducedby.tfidf.matrix.df, cluster = dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids$cluster)
head(dtm.tf.features.reducedby.tfidf.kmedoids.clusters)

#
dtm.tf.features.reducedby.rst.kmedoids.cluster.stats <- aggregate(dtm.tf.features.reducedby.rst.matrix.df, by = list(cluster = dtm.tf.features.reducedby.rst.matrix.df.kmedoids$cluster), mean)
# commented due to huge size
# head(dtm.tf.features.reducedby.rst.kmedoids.cluster.stats)

dtm.tf.features.reducedby.rst.kmedoids.clusters <- cbind(dtm.tf.features.reducedby.rst.matrix.df, cluster = dtm.tf.features.reducedby.rst.matrix.df.kmedoids$cluster)
# commented due to huge size
# head(dtm.tf.features.reducedby.rst.kmedoids.clusters)
```

#### visualisation for dtm.tf.features.reducedby.tfidf.kmedoids.cluster.plot
```{r,fig.width=40, fig.height=15}
# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.tfidf.kmedoids.cluster.plot <- fviz_cluster(dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids, dtm.tf.features.reducedby.tfidf.matrix.df) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tf.features.reducedby.tfidf; kmedoids; k =", dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids.cluster_cnt))

dtm.tf.features.reducedby.tfidf.kmedoids.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.tfidf.kmedoids.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = dtm.tf.features.reducedby.tfidf.kmedoids.cluster.plot)

```

#### visualisation for dtm.tf.features.reducedby.rst.kmedoids.cluster.plot
```{r,fig.width=40, fig.height=20}
# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.rst.kmedoids.cluster.plot <- fviz_cluster(dtm.tf.features.reducedby.rst.matrix.df.kmedoids, dtm.tf.features.reducedby.rst.matrix.df) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tf.features.reducedby.rst; kmedoids; k =", dtm.tf.features.reducedby.rst.matrix.df.kmedoids.cluster_cnt))

dtm.tf.features.reducedby.rst.kmedoids.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.rst.kmedoids.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = dtm.tf.features.reducedby.rst.kmedoids.cluster.plot, limitsize = F)

```

### for dtm.tfidf.features.reducedby.tfidf and dtm.tfidf.features.reducedby.rst
```{r}
# calculation section
set.seed(1234)

#
dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids <- pam(dtm.tfidf.features.reducedby.tfidf.matrix.df, dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids.cluster_cnt, nstart = 25)

#
dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids <- pam(dtm.tfidf.features.reducedby.rst.matrix.df, dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids.cluster_cnt, nstart = 25)

#
dtm.tfidf.features.reducedby.tfidf.kmedoids.cluster.stats <- aggregate(dtm.tfidf.features.reducedby.tfidf.matrix.df, by = list(cluster = dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids$cluster), mean)
head(dtm.tfidf.features.reducedby.tfidf.kmedoids.cluster.stats)

dtm.tfidf.features.reducedby.tfidf.kmedoids.clusters <- cbind(dtm.tfidf.features.reducedby.tfidf.matrix.df, cluster = dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids$cluster)
head(dtm.tfidf.features.reducedby.tfidf.kmedoids.clusters)

#
dtm.tfidf.features.reducedby.rst.kmedoids.cluster.stats <- aggregate(dtm.tfidf.features.reducedby.rst.matrix.df, by = list(cluster = dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids$cluster), mean)
# commented due to huge size
# head(dtm.tfidf.features.reducedby.rst.kmedoids.cluster.stats)

dtm.tfidf.features.reducedby.rst.kmedoids.clusters <- cbind(dtm.tfidf.features.reducedby.rst.matrix.df, cluster = dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids$cluster)
# commented due to huge size
# head(dtm.tfidf.features.reducedby.rst.kmedoids.clusters)

```

#### visualisation for dtm.tfidf.features.reducedby.tfidf.kmedoids.cluster.plot
```{r,fig.width=40, fig.height=15}
# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.tfidf.kmedoids.cluster.plot <- fviz_cluster(dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids, dtm.tfidf.features.reducedby.tfidf.matrix.df) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tfidf.features.reducedby.tfidf; kmedoids; k =", dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids.cluster_cnt))

dtm.tfidf.features.reducedby.tfidf.kmedoids.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.tfidf.kmedoids.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = dtm.tfidf.features.reducedby.tfidf.kmedoids.cluster.plot)

```

#### visualisation for dtm.tfidf.features.reducedby.rst.kmedoids.cluster.plot
```{r,fig.width=40, fig.height=20}
# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.rst.kmedoids.cluster.plot <- fviz_cluster(dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids, dtm.tfidf.features.reducedby.rst.matrix.df) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tfidf.features.reducedby.rst; kmedoids; k =", dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids.cluster_cnt))

dtm.tfidf.features.reducedby.rst.kmedoids.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.rst.kmedoids.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = dtm.tfidf.features.reducedby.rst.kmedoids.cluster.plot, limitsize = F)

```

## retrieve all the cluster allocations
```{r}
kmedoids.cluster.alloc.combined <- data.frame(dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids$clustering)
kmedoids.cluster.alloc.combined <- cbind(kmedoids.cluster.alloc.combined, dtm.tf.features.reducedby.rst.matrix.df.kmedoids$clustering)
kmedoids.cluster.alloc.combined <- cbind(kmedoids.cluster.alloc.combined, dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids$clustering)
kmedoids.cluster.alloc.combined <- cbind(kmedoids.cluster.alloc.combined, dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids$clustering)
colnames(kmedoids.cluster.alloc.combined) <- c("tf_tfidf","tf_rst","tfidf_ifidf","tfidf_rst")

# UC.06 Informationen visualisieren
head(kmedoids.cluster.alloc.combined)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(kmedoids = kmedoids.cluster.alloc.combined))
uc07_data(kmedoids.cluster.alloc.combined,"xlsx")
# write.xlsx(kmedoids.cluster.alloc.combined, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/kmedoids.cluster.alloc.combined_",cv,cc,".xlsx", sep=""))
```

## Latent Semantic Analysis (LSA) with cosine-based and kmeans-clustering and hcut-cosine similarity
### create the lsa spaces
```{r}
# creation of the various semantic spaces

## myLSAspace.tdm.tf.features.reducedby.tfidf
tdm.tf.features.reducedby.tfidf.myLSAspace <- lsa(tdm.tf.features.reducedby.tfidf, dims = dimcalc_share())

# myLSAspace.tdm.tf.features.reducedby.rst
tdm.tf.features.reducedby.rst.myLSAspace <- lsa(tdm.tf.features.reducedby.rst, dims = dimcalc_share())

# myLSAspace.tdm.tfidf.features.reducedby.tfidf
tdm.tfidf.features.reducedby.tfidf.myLSAspace <- lsa(tdm.tfidf.features.reducedby.tfidf, dims = dimcalc_share())

# myLSAspace.tdm.tfidf.features.reducedby.rst
tdm.tfidf.features.reducedby.rst.myLSAspace <- lsa(tdm.tfidf.features.reducedby.rst, dims = dimcalc_share())

```

### determine the cluster tendency
```{r}
tdm.tf.features.reducedby.tfidf.myLSAspace.gct <- get_clust_tendency(tdm.tf.features.reducedby.tfidf.myLSAspace$dk, nrow(tdm.tf.features.reducedby.tfidf.myLSAspace$dk)-1, seed = 1234)

tdm.tf.features.reducedby.rst.myLSAspace.gct <- get_clust_tendency(tdm.tf.features.reducedby.rst.myLSAspace$dk, nrow(tdm.tf.features.reducedby.rst.myLSAspace$dk)-1, seed = 1234)

tdm.tfidf.features.reducedby.tfidf.myLSAspace.gct <- get_clust_tendency(tdm.tfidf.features.reducedby.tfidf.myLSAspace$dk, nrow(tdm.tfidf.features.reducedby.tfidf.myLSAspace$dk)-1, seed = 1234)

tdm.tfidf.features.reducedby.rst.myLSAspace.gct <- get_clust_tendency(tdm.tfidf.features.reducedby.rst.myLSAspace$dk, nrow(tdm.tfidf.features.reducedby.rst.myLSAspace$dk)-1, seed = 1234)

tdm.tf_tfidf.myLSAspace.gct <- data.frame(LSA_ClusterTendency = c(tdm.tf.features.reducedby.tfidf.myLSAspace.gct$hopkins_stat,tdm.tf.features.reducedby.rst.myLSAspace.gct$hopkins_stat,tdm.tfidf.features.reducedby.tfidf.myLSAspace.gct$hopkins_stat,tdm.tfidf.features.reducedby.rst.myLSAspace.gct$hopkins_stat), row.names = c("tf_tfidf","tf_rst","tfidf_tfidf","tfidf_rst"))
tdm.tf_tfidf.myLSAspace.gct <- t(tdm.tf_tfidf.myLSAspace.gct)

```

### visualize certain aspects of the lsa space in tabular form (term and doc count, dimensions)
```{r}
# UC.06 Informationen visualisieren
# display certain aspects of the tdm.tf.features.reducedby.tfidf.lsa
tdm.tf.features.reducedby.tfidf.lsa.result.df <- data.frame(dim(tdm.tf.features.reducedby.tfidf.myLSAspace$tk), dim(tdm.tf.features.reducedby.tfidf.myLSAspace$dk), row.names = c("Term/Doc_counts", "LSA_dimensions_tf"))

tdm.tf.features.reducedby.tfidf.lsa.result.df[nrow(tdm.tf.features.reducedby.tfidf.lsa.result.df) + 1,] <- data.frame(dim(tdm.tf.features.reducedby.tfidf.myLSAspace$tk)[2],dim(tdm.tf.features.reducedby.tfidf.myLSAspace$dk)[2], row.names = c("LSA_dimensions_tfidf"))
colnames(tdm.tf.features.reducedby.tfidf.lsa.result.df) <- c("LSA_Term_Matrix","LSA_Doc_Matrix")
tdm.tf.features.reducedby.tfidf.lsa.result.df

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tf_tfidf.lsa = tdm.tf.features.reducedby.tfidf.lsa.result.df))
uc07_data(tdm.tf.features.reducedby.tfidf.lsa.result.df,"xlsx")
# write.xlsx(tdm.tf.features.reducedby.tfidf.lsa.result.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.features.reducedby.tfidf.lsa.result.df_",cv,cc,".xlsx", sep=""))

# UC.06 Informationen austauschen
# display certain aspects of the tdm.tf.features.reducedby.rst.lsa
tdm.tf.features.reducedby.rst.lsa.result.df <- data.frame(dim(tdm.tf.features.reducedby.rst.myLSAspace$tk), dim(tdm.tf.features.reducedby.rst.myLSAspace$dk), row.names = c("Term/Doc_counts", "LSA_dimensions_tf"))

tdm.tf.features.reducedby.rst.lsa.result.df[nrow(tdm.tf.features.reducedby.rst.lsa.result.df) + 1,] <- data.frame(dim(tdm.tf.features.reducedby.rst.myLSAspace$tk)[2],dim(tdm.tf.features.reducedby.rst.myLSAspace$dk)[2], row.names = c("LSA_dimensions_tfidf"))
colnames(tdm.tf.features.reducedby.rst.lsa.result.df) <- c("LSA_Term_Matrix","LSA_Doc_Matrix")
tdm.tf.features.reducedby.rst.lsa.result.df

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tf_rst.lsa = tdm.tf.features.reducedby.rst.lsa.result.df))
uc07_data(tdm.tf.features.reducedby.rst.lsa.result.df,"xlsx")
# write.xlsx(tdm.tf.features.reducedby.rst.lsa.result.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.features.reducedby.rst.lsa.result.df_",cv,cc,".xlsx", sep=""))

# UC.06 Informationen visualisieren
# display certain aspects of the tdm.tfidf.features.reducedby.tfidf.lsa
tdm.tfidf.features.reducedby.tfidf.lsa.result.df <- data.frame(dim(tdm.tfidf.features.reducedby.tfidf.myLSAspace$tk), dim(tdm.tfidf.features.reducedby.tfidf.myLSAspace$dk), row.names = c("Term/Doc_counts", "LSA_dimensions_tf"))

tdm.tfidf.features.reducedby.tfidf.lsa.result.df[nrow(tdm.tfidf.features.reducedby.tfidf.lsa.result.df) + 1,] <- data.frame(dim(tdm.tfidf.features.reducedby.tfidf.myLSAspace$tk)[2],dim(tdm.tfidf.features.reducedby.tfidf.myLSAspace$dk)[2], row.names = c("LSA_dimensions_tfidf"))
colnames(tdm.tfidf.features.reducedby.tfidf.lsa.result.df) <- c("LSA_Term_Matrix","LSA_Doc_Matrix")
tdm.tfidf.features.reducedby.tfidf.lsa.result.df

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tfidf_tfidf.lsa = tdm.tfidf.features.reducedby.tfidf.lsa.result.df))
uc07_data(tdm.tfidf.features.reducedby.tfidf.lsa.result.df,"xlsx")
# write.xlsx(tdm.tfidf.features.reducedby.tfidf.lsa.result.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.features.reducedby.tfidf.lsa.result.df_",cv,cc,".xlsx", sep=""))

# UC.06 Informationen visualisieren
# display certain aspects of the tdm.tfidf.features.reducedby.rst.lsa
tdm.tfidf.features.reducedby.rst.lsa.result.df <- data.frame(dim(tdm.tfidf.features.reducedby.rst.myLSAspace$tk), dim(tdm.tfidf.features.reducedby.rst.myLSAspace$dk), row.names = c("Term/Doc_counts", "LSA_dimensions_tf"))

tdm.tfidf.features.reducedby.rst.lsa.result.df[nrow(tdm.tfidf.features.reducedby.rst.lsa.result.df) + 1,] <- data.frame(dim(tdm.tfidf.features.reducedby.rst.myLSAspace$tk)[2],dim(tdm.tfidf.features.reducedby.rst.myLSAspace$dk)[2], row.names = c("LSA_dimensions_tfidf"))
colnames(tdm.tfidf.features.reducedby.rst.lsa.result.df) <- c("LSA_Term_Matrix","LSA_Doc_Matrix")
tdm.tfidf.features.reducedby.rst.lsa.result.df

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tfidf_rst.lsa = tdm.tfidf.features.reducedby.rst.lsa.result.df))
uc07_data(tdm.tfidf.features.reducedby.rst.lsa.result.df,"xlsx")
# write.xlsx(tdm.tfidf.features.reducedby.rst.lsa.result.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.features.reducedby.rst.lsa.result.df_",cv,cc,".xlsx", sep=""))
```
### visualize the lsa-space for documents with scatter plot
#### for tdm.tf.features.reducedby.tfidf
```{r}
# calculation section
tdm.tf.features.reducedby.tfidf.myLSAtk = t(tdm.tf.features.reducedby.tfidf.myLSAspace$sk * t(tdm.tf.features.reducedby.tfidf.myLSAspace$tk))

tdm.tf.features.reducedby.tfidf.myLSAdk = t(tdm.tf.features.reducedby.tfidf.myLSAspace$sk * t(tdm.tf.features.reducedby.tfidf.myLSAspace$dk))

# UC.06 Informationen visualisieren
tdm.tf.features.reducedby.tfidf.myLSAdk.ggplot <- ggplot(data = as.data.frame(tdm.tf.features.reducedby.tfidf.myLSAdk), aes(x=V1,y=V2)) +geom_point(size = .5) +geom_text(label = rownames(as.data.frame(tdm.tf.features.reducedby.tfidf.myLSAdk)), size = 2, nudge_x = 5, nudge_y = 5) +theme(axis.title = element_blank(), axis.text = element_blank(), panel.background = element_blank(), axis.ticks = element_blank(), panel.border = element_rect(size = 0.3, linetype = 1, fill = NA)) +ggtitle("Evaluation of document similarity", subtitle = "Scatter plot; tdm.tf.features.reducedby.tfidf; Latent Semantic Analysis")
tdm.tf.features.reducedby.tfidf.myLSAdk.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tf.features.reducedby.tfidf.myLSAdk.ggplot_",cv,cc,".png", sep = ""), dpi = 300, plot = tdm.tf.features.reducedby.tfidf.myLSAdk.ggplot, limitsize = F)
```
#### for tdm.tf.features.reducedby.rst
```{r}
# calculation section
tdm.tf.features.reducedby.rst.myLSAtk = t(tdm.tf.features.reducedby.rst.myLSAspace$sk * t(tdm.tf.features.reducedby.rst.myLSAspace$tk))

tdm.tf.features.reducedby.rst.myLSAdk = t(tdm.tf.features.reducedby.rst.myLSAspace$sk * t(tdm.tf.features.reducedby.rst.myLSAspace$dk))

# UC.06 Informationen visualisieren
tdm.tf.features.reducedby.rst.myLSAdk.ggplot <- ggplot(data = as.data.frame(tdm.tf.features.reducedby.rst.myLSAdk), aes(x=V1,y=V2)) +geom_point(size = .5) +geom_text(label = rownames(as.data.frame(tdm.tf.features.reducedby.rst.myLSAdk)), size = 2, nudge_x = 5, nudge_y = 5) +theme(axis.title = element_blank(), axis.text = element_blank(), panel.background = element_blank(), axis.ticks = element_blank(), panel.border = element_rect(size = 0.3, linetype = 1, fill = NA)) +ggtitle("Evaluation of document similarity", subtitle = "Scatter plot; tdm.tf.features.reducedby.rst; Latent Semantic Analysis")
tdm.tf.features.reducedby.rst.myLSAdk.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tf.features.reducedby.rst.myLSAdk.ggplot_",cv,cc,".png", sep = ""), dpi = 300, plot = tdm.tf.features.reducedby.rst.myLSAdk.ggplot, limitsize = F)
```
#### for tdm.tfidf.features.reducedby.tfidf
```{r}
# calculation section
tdm.tfidf.features.reducedby.tfidf.myLSAtk = t(tdm.tfidf.features.reducedby.tfidf.myLSAspace$sk * t(tdm.tfidf.features.reducedby.tfidf.myLSAspace$tk))

tdm.tfidf.features.reducedby.tfidf.myLSAdk = t(tdm.tfidf.features.reducedby.tfidf.myLSAspace$sk * t(tdm.tfidf.features.reducedby.tfidf.myLSAspace$dk))

# UC.06 Informationen visualisieren
tdm.tfidf.features.reducedby.tfidf.myLSAdk.ggplot <- ggplot(data = as.data.frame(tdm.tfidf.features.reducedby.tfidf.myLSAdk), aes(x=V1,y=V2)) +geom_point(size = .5) +geom_text(label = rownames(as.data.frame(tdm.tfidf.features.reducedby.tfidf.myLSAdk)), size = 2, nudge_x = 5, nudge_y = 5) +theme(axis.title = element_blank(), axis.text = element_blank(), panel.background = element_blank(), axis.ticks = element_blank(), panel.border = element_rect(size = 0.3, linetype = 1, fill = NA)) +ggtitle("Evaluation of document similarity", subtitle = "Scatter plot; tdm.tfidf.features.reducedby.tfidf; Latent Semantic Analysis")
tdm.tfidf.features.reducedby.tfidf.myLSAdk.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.features.reducedby.tfidf.myLSAdk.ggplot_",cv,cc,".png", sep = ""), dpi = 300, plot = tdm.tfidf.features.reducedby.tfidf.myLSAdk.ggplot, limitsize = F)
```
#### for tdm.tfidf.features.reducedby.rst
```{r}
# calculation section
tdm.tfidf.features.reducedby.rst.myLSAtk = t(tdm.tfidf.features.reducedby.rst.myLSAspace$sk * t(tdm.tfidf.features.reducedby.rst.myLSAspace$tk))

tdm.tfidf.features.reducedby.rst.myLSAdk = t(tdm.tfidf.features.reducedby.rst.myLSAspace$sk * t(tdm.tfidf.features.reducedby.rst.myLSAspace$dk))

# UC.06 Informationen visualisieren
tdm.tfidf.features.reducedby.rst.myLSAdk.ggplot <- ggplot(data = as.data.frame(tdm.tfidf.features.reducedby.rst.myLSAdk), aes(x=V1,y=V2)) +geom_point(size = .5) +geom_text(label = rownames(as.data.frame(tdm.tfidf.features.reducedby.rst.myLSAdk)), size = 2, nudge_x = 5, nudge_y = 5) +theme(axis.title = element_blank(), axis.text = element_blank(), panel.background = element_blank(), axis.ticks = element_blank(), panel.border = element_rect(size = 0.3, linetype = 1, fill = NA)) +ggtitle("Evaluation of document similarity", subtitle = "Scatter plot; tdm.tfidf.features.reducedby.rst; Latent Semantic Analysis")
tdm.tfidf.features.reducedby.rst.myLSAdk.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.features.reducedby.rst.myLSAdk.ggplot_",cv,cc,".png", sep = ""), dpi = 300, plot = tdm.tfidf.features.reducedby.rst.myLSAdk.ggplot, limitsize = F)

```

### LSA with cosine-clustering
```{r}
# calculation section
tdm.tf.features.reducedby.tfidf.myLSAdk.myDocs <- rownames(tdm.tf.features.reducedby.tfidf.myLSAdk)
tdm.tf.features.reducedby.tfidf.myLSAdk.myCosineSpace <- multicos(tdm.tf.features.reducedby.tfidf.myLSAdk.myDocs, tvectors = tdm.tf.features.reducedby.tfidf.myLSAdk)

tdm.tf.features.reducedby.rst.myLSAdk.myDocs <- rownames(tdm.tf.features.reducedby.rst.myLSAdk)
tdm.tf.features.reducedby.rst.myLSAdk.myCosineSpace <- multicos(tdm.tf.features.reducedby.rst.myLSAdk.myDocs, tvectors = tdm.tf.features.reducedby.rst.myLSAdk)

tdm.tfidf.features.reducedby.tfidf.myLSAdk.myDocs <- rownames(tdm.tfidf.features.reducedby.tfidf.myLSAdk)
tdm.tfidf.features.reducedby.tfidf.myLSAdk.myCosineSpace <- multicos(tdm.tfidf.features.reducedby.tfidf.myLSAdk.myDocs, tvectors = tdm.tfidf.features.reducedby.tfidf.myLSAdk)

tdm.tfidf.features.reducedby.rst.myLSAdk.myDocs <- rownames(tdm.tfidf.features.reducedby.rst.myLSAdk)
tdm.tfidf.features.reducedby.rst.myLSAdk.myCosineSpace <- multicos(tdm.tfidf.features.reducedby.rst.myLSAdk.myDocs, tvectors = tdm.tfidf.features.reducedby.rst.myLSAdk)

```

#### visualize the results for tdm.tf.features.reducedby.tfidf
```{r}
# UC.06 Informationen visualisieren
display.amount.max <- 15
# display.amount.max <- length(tdm.tf.features.reducedby.tfidf.myLSAdk.myDocs)

neighbors(tdm.tf.features.reducedby.tfidf.myLSAdk.myDocs, n = display.amount.max, tvectors = tdm.tf.features.reducedby.tfidf.myLSAdk[,1:2])

n <- neighbors(tdm.tf.features.reducedby.tfidf.myLSAdk.myDocs, n = display.amount.max, tvectors = tdm.tf.features.reducedby.tfidf.myLSAdk[,1:2])
dfn <- data.frame(n)

plot_neighbors(tdm.tf.features.reducedby.tfidf.myLSAdk.myDocs, n = display.amount.max, tvectors = tdm.tf.features.reducedby.tfidf.myLSAdk[,1:2])

```

#### visualize the results for tdm.tf.features.reducedby.tfidf
```{r}

tdm.tf.features.reducedby.tfidf.myLSAdk.temp <- tdm.tf.features.reducedby.tfidf.myLSAdk[row.names(dfn),]

# UC.06 Informationen visualisieren
tdm.tf.features.reducedby.tfidf.myLSAdk.temp.ggplot <- ggplot(data = as.data.frame(tdm.tf.features.reducedby.tfidf.myLSAdk.temp), aes(x=V1,y=V2)) +geom_point(size = .5) +geom_text(label = rownames(as.data.frame(tdm.tf.features.reducedby.tfidf.myLSAdk.temp)), size = 2, nudge_x = 5, nudge_y = 2) +theme(axis.title = element_blank(), axis.text = element_blank(), panel.background = element_blank(), axis.ticks = element_blank(), panel.border = element_rect(size = 0.3, linetype = 1, fill = NA)) +ggtitle("Evaluation of document similarity", subtitle = "Scatter plot; tdm.tf.features.reducedby.tfidf; Latent Semantic Analysis")
tdm.tf.features.reducedby.tfidf.myLSAdk.temp.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tf.features.reducedby.tfidf.myLSAdk.temp.ggplot_",cv,cc,".png", sep = ""), dpi = 300, plot = tdm.tf.features.reducedby.tfidf.myLSAdk.temp.ggplot, limitsize = F)
```

#### visualize the results for tdm.tf.features.reducedby.rst
```{r}
# UC.06 Informationen visualisieren
neighbors(tdm.tf.features.reducedby.rst.myLSAdk.myDocs, n = display.amount.max, tvectors = tdm.tf.features.reducedby.rst.myLSAdk[,1:2])

plot_neighbors(tdm.tf.features.reducedby.rst.myLSAdk.myDocs, n = display.amount.max, tvectors = tdm.tf.features.reducedby.rst.myLSAdk[,1:2])
```

#### visualize the results for tdm.tfidf.features.reducedby.tfidf
```{r}
# UC.06 Informationen visualisieren
neighbors(tdm.tfidf.features.reducedby.tfidf.myLSAdk.myDocs, n = display.amount.max, tvectors = tdm.tfidf.features.reducedby.tfidf.myLSAdk[,1:2])

plot_neighbors(tdm.tfidf.features.reducedby.tfidf.myLSAdk.myDocs, n = display.amount.max, tvectors = tdm.tfidf.features.reducedby.tfidf.myLSAdk[,1:2])
```

#### visualize the results for tdm.tfidf.features.reducedby.rst
```{r}
# UC.06 Informationen visualisieren
neighbors(tdm.tfidf.features.reducedby.rst.myLSAdk.myDocs, n = display.amount.max, tvectors = tdm.tfidf.features.reducedby.rst.myLSAdk[,1:2])

plot_neighbors(tdm.tfidf.features.reducedby.rst.myLSAdk.myDocs, n = display.amount.max, tvectors = tdm.tfidf.features.reducedby.rst.myLSAdk[,1:2])
```

### LSA with kmeans-clustering
```{r}
# https://www.quora.com/How-is-LSA-used-for-a-text-document-clustering
# calculation section
tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans <- kmeans(tdm.tf.features.reducedby.tfidf.myLSAspace$dk, tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans.cluster_cnt, nstart = 25)

tdm.tf.features.reducedby.rst.myLSAspace.kmeans <- kmeans(tdm.tf.features.reducedby.rst.myLSAspace$dk, tdm.tf.features.reducedby.rst.myLSAspace.kmeans.cluster_cnt, nstart = 25)

tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans <- kmeans(tdm.tf.features.reducedby.tfidf.myLSAspace$dk, tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans.cluster_cnt, nstart = 25)

tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans <- kmeans(tdm.tf.features.reducedby.rst.myLSAspace$dk, tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans.cluster_cnt, nstart = 25)

```

#### visualize the results for tdm.tf.features.reducedby.tfidf
```{r, fig.height=20, fig.width=20}
# UC.06 Informationen visualisieren
tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans.cluster.plot <- fviz_cluster(tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans, data = t(tdm.tf.features.reducedby.tfidf.matrix.df)) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tf.features.reducedby.tfidf; LSA; kmeans; k =", tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans.cluster_cnt))

tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans.cluster.plot, limitsize = F)

```
#### visualize the results for tdm.tf.features.reducedby.rst
```{r, fig.height=20, fig.width=40}
# UC.06 Informationen visualisieren
tdm.tf.features.reducedby.rst.myLSAspace.kmeans.cluster.plot <- fviz_cluster(tdm.tf.features.reducedby.rst.myLSAspace.kmeans, data = t(tdm.tf.features.reducedby.rst.matrix.df)) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tf.features.reducedby.rst; LSA; kmeans; k =", tdm.tf.features.reducedby.rst.myLSAspace.kmeans.cluster_cnt))

tdm.tf.features.reducedby.rst.myLSAspace.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tf.features.reducedby.rst.myLSAspace.kmeans.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = tdm.tf.features.reducedby.rst.myLSAspace.kmeans.cluster.plot, limitsize = F)

```

#### visualize the results for tdm.tfidf.features.reducedby.tfidf
```{r, fig.height=20, fig.width=40}
# UC.06 Informationen visualisieren
tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans.cluster.plot <- fviz_cluster(tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans, data = t(tdm.tfidf.features.reducedby.tfidf.matrix.df)) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tfidf.features.reducedby.tfidf; LSA; kmeans; k =", tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans.cluster_cnt))

tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans.cluster.plot_",cv,cc,".png", sep = ""), dpi = 300, plot = tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans.cluster.plot, limitsize = F)
```

#### visualize the results for tdm.tfidf.features.reducedby.rst
```{r, fig.height=20, fig.width=40}
# UC.06 Informationen visualisieren
tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans.cluster.plot <- fviz_cluster(tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans, data = t(tdm.tfidf.features.reducedby.rst.matrix.df)) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tfidf.features.reducedby.rst; LSA; kmeans; k =", tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans.cluster_cnt))

tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans.cluster.plot_",cv,cc,".png",sep = ""), dpi = 300, plot = tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans.cluster.plot, limitsize = F)

```

#### retrieve the kmeans based cluster allocation
```{r}

myLSAspace.kmeans.cluster.alloc.combined <- data.frame(tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans$cluster)

myLSAspace.kmeans.cluster.alloc.combined <- cbind(myLSAspace.kmeans.cluster.alloc.combined, tdm.tf.features.reducedby.rst.myLSAspace.kmeans$cluster)

myLSAspace.kmeans.cluster.alloc.combined <- cbind(myLSAspace.kmeans.cluster.alloc.combined, tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans$cluster)

myLSAspace.kmeans.cluster.alloc.combined <- cbind(myLSAspace.kmeans.cluster.alloc.combined, tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans$cluster)

colnames(myLSAspace.kmeans.cluster.alloc.combined) <- c("tf_tfidf", "tf_rst","tfidf_tfidf","tfidf_rst")

# UC.06 Informationen visualisieren
head(myLSAspace.kmeans.cluster.alloc.combined)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(lsa.kmeans = myLSAspace.kmeans.cluster.alloc.combined))
uc07_data(myLSAspace.kmeans.cluster.alloc.combined,"xlsx")
# write.xlsx(myLSAspace.kmeans.cluster.alloc.combined, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/myLSAspace.kmeans.cluster.alloc.combined_",cv,cc,".xlsx", sep=""))
```

### LSA with cosine similarity (an LSA-based  approach for clustering with cosine similarities matrix and hierarchical clustering)
#### for tdm.tf.features.reducedby.tfidf
```{r, fig.height=40, fig.width=40}
# an approach for clustering with cosine similarities matrix (substract from 1 to get the dissimilarity matrix) and hierarchical clustering
# https://stackoverflow.com/questions/15229584/compute-cosine-similarities-between-documents-in-semantic-space-using-r-lsa-pac

# for tdm.tf.features.reducedby.tfidf

tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix <- diag(tdm.tf.features.reducedby.tfidf.myLSAspace$sk) %*% t(tdm.tf.features.reducedby.tfidf.myLSAspace$dk)

tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine <- 1 - cosine(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix)

tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine[is.na(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine)] <- 0

tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist <- dist(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine)

tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust <- hclust(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist, method = "ward.D")

# UC.06 Informationen visualisieren
plot(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust)

tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc <- rect.hclust(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust, k = tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt, border = "red")

# visualize the results with ggplot
tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot <- fviz_dend(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust, rect_lty = 1, lwd = 0.2, rect = T , k = tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt, cex = 0.2, ggtheme = theme_classic(), palette = fviz_dend.color.palette)

tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot <- tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot +ggtitle("Determination of cluster members", subtitle = paste("Cluster dendrogram; tdm.tf.features.reducedby.tfidf; LSA; ward.D; k =", tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt)) +xlab("Documents in the Corpus")

tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot_",cv,cc,".png", sep = ""), plot = tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot, dpi = 300)
```

#### for tdm.tf.features.reducedby.rst
```{r, fig.height=40, fig.width=40}
# an approach for clustering with cosine similarities matrix (substract from 1 to get the dissimilarity matrix) and hierarchical clustering
# https://stackoverflow.com/questions/15229584/compute-cosine-similarities-between-documents-in-semantic-space-using-r-lsa-pac

# for tdm.tf.features.reducedby.rst

tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix <- diag(tdm.tf.features.reducedby.rst.myLSAspace$sk) %*% t(tdm.tf.features.reducedby.rst.myLSAspace$dk)

tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine <- 1 - cosine(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix)

tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine[is.na(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine)] <- 0

tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist <- dist(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine)

tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust <- hclust(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist, method = "ward.D")

# UC.06 Informationen visualisieren
plot(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust)

tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc <- rect.hclust(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust, k = tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt, border = "red")

# visualize the results with ggplot
tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot <- fviz_dend(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust, rect_lty = 1, lwd = 0.2, rect = T , k = tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt, ggtheme = theme_classic(), palette = fviz_dend.color.palette)

tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot <- tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot +ggtitle("Determination of cluster members", subtitle = paste("Cluster dendrogram; tdm.tf.features.reducedby.rst; LSA; ward.D; k =", tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt)) +xlab("Documents in the Corpus")

tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot_",cv,cc,".png", sep = ""), plot = tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot, dpi = 300)

```

#### for tdm.tfidf.features.reducedby.tfidf
```{r, fig.height=40, fig.width=40}
# an approach for clustering with cosine similarities matrix (substract from 1 to get the dissimilarity matrix) and hierarchical clustering
# references:
# https://stackoverflow.com/questions/15229584/compute-cosine-similarities-between-documents-in-semantic-space-using-r-lsa-pac

# for tdm.tfidf.features.reducedby.tfidf

tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix <- diag(tdm.tfidf.features.reducedby.tfidf.myLSAspace$sk) %*% t(tdm.tfidf.features.reducedby.tfidf.myLSAspace$dk)

tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine <- 1 - cosine(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix)

tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine[is.na(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine)] <- 0

tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist <- dist(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine)

tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust <- hclust(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist, method = "ward.D")

# UC.06 Informationen visualisieren
plot(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust)

tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc <- rect.hclust(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust, k = tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt, border = "red")

# visualize the results with ggplot
tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot <- fviz_dend(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust, rect_lty = 1, lwd = 0.2, rect = T , k = tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt, ggtheme = theme_classic(), palette = fviz_dend.color.palette)

tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot <- tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot +ggtitle("Determination of cluster members", subtitle = paste("Cluster dendrogram; tdm.tfidf.features.reducedby.tfidf; LSA; ward.D; k =", tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt)) +xlab("Documents in the Corpus")

tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot_",cv,cc,".png", sep = ""), plot = tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot, dpi = 300)

```

#### for tdm.tfidf.features.reducedby.rst
```{r, fig.height=10, fig.width=10}
# an approach for clustering with cosine similarities matrix (substract from 1 to get the dissimilarity matrix) and hierarchical clustering
# references:
# https://stackoverflow.com/questions/15229584/compute-cosine-similarities-between-documents-in-semantic-space-using-r-lsa-pac

# for tdm.tfidf.features.reducedby.rst

tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix <- diag(tdm.tfidf.features.reducedby.rst.myLSAspace$sk) %*% t(tdm.tfidf.features.reducedby.rst.myLSAspace$dk)

tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine <- 1 - cosine(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix)

tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine[is.na(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine)] <- 0

tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist <- dist(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine)

tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust <- hclust(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist, method = "ward.D")

# UC.06 Informationen visualisieren
plot(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust)

tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc <- rect.hclust(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust, k = tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt, border = "red")

# visualize the results with ggplot
tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot <- fviz_dend(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust, rect_lty = 1, lwd = 0.2, rect = T , k = tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt, cex = 0.2, ggtheme = theme_classic(), palette = fviz_dend.color.palette)

tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot <- tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot +ggtitle("Determination of cluster members", subtitle = paste("Cluster dendrogram; tdm.tfidf.features.reducedby.rst; LSA; ward.D; k =", tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.cluster_cnt)) +xlab("Documents in the Corpus")

tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot_",cv,cc,".png", sep = ""), plot = tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.ggplot, dpi = 300)
```

#### retrieve the lsa cosine based cluster allocations for tdm.tf.features.reducedby.tfidf
```{r}
tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- data.frame()

for (clusterno in 1:length(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc)) {
  df.temp <- as.data.frame(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc[[clusterno]])
  df1.temp <- data.frame(rep(clusterno,times=length(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc[[clusterno]])))
  df.temp <- cbind(df.temp,df1.temp)
  colnames(df.temp) <- c("corpus_item","cluster_number")
  tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- rbind(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df,df.temp)
}

tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df[order(row.names(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df)),]

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tf_tfidf.lsa.cosine = tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df))
uc07_data(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df,"xlsx")
# write.xlsx(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df_",cv,cc,".xlsx", sep=""))

```

#### retrieve the cosine based cluster allocation for tdm.tf.features.reducedby.rst
```{r}
tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- data.frame()

for (clusterno in 1:length(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc)) {
  df.temp <- as.data.frame(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc[[clusterno]])
  df1.temp <- data.frame(rep(clusterno,times=length(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc[[clusterno]])))
  df.temp <- cbind(df.temp,df1.temp)
  colnames(df.temp) <- c("corpus_item","cluster_number")
  tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- rbind(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df,df.temp)
}

tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df[order(row.names(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df)),]

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tf_rst.lsa.cosine = tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df))
uc07_data(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df,"xlsx")
# write.xlsx(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df_",cv,cc,".xlsx", sep=""))

```

#### retrieve the cosine based cluster allocation for tdm.tfidf.features.reducedby.tfidf
```{r}
tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- data.frame()

for (clusterno in 1:length(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc)) {
  df.temp <- as.data.frame(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc[[clusterno]])
  df1.temp <- data.frame(rep(clusterno,times=length(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc[[clusterno]])))
  df.temp <- cbind(df.temp,df1.temp)
  colnames(df.temp) <- c("corpus_item","cluster_number")
  tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- rbind(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df,df.temp)
}

tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df[order(row.names(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df)),]

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tfidf_tfidf.lsa.cosine = tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df))
uc07_data(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df,"xlsx")
# write.xlsx(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df_",cv,cc,".xlsx", sep=""))
```

#### retrieve the cosine based cluster allocation for tdm.tfidf.features.reducedby.rst
```{r}
tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- data.frame()

for (clusterno in 1:length(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc)) {
  df.temp <- as.data.frame(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc[[clusterno]])
  df1.temp <- data.frame(rep(clusterno,times=length(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc[[clusterno]])))
  df.temp <- cbind(df.temp,df1.temp)
  colnames(df.temp) <- c("corpus_item","cluster_number")
  tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- rbind(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df,df.temp)
}

tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df <- tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df[order(row.names(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df)),]

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(tdm.tfidf_rst.lsa.cosine = tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df))
uc07_data(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df,"xlsx")
# write.xlsx(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df_",cv,cc,".xlsx", sep=""))
```

#### retrieve the cosine distance hclust based cluster allocation
```{r}
myLSAspace.cosine.dist.hclust.alloc.combined <- data.frame()

myLSAspace.cosine.dist.hclust.alloc.combined <- tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df[2]

myLSAspace.cosine.dist.hclust.alloc.combined <- cbind(myLSAspace.cosine.dist.hclust.alloc.combined, tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df[2])

myLSAspace.cosine.dist.hclust.alloc.combined <- cbind(myLSAspace.cosine.dist.hclust.alloc.combined, tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df[2])

myLSAspace.cosine.dist.hclust.alloc.combined <- cbind(myLSAspace.cosine.dist.hclust.alloc.combined, tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df[2])

colnames(myLSAspace.cosine.dist.hclust.alloc.combined) <- c("tf_tfidf", "tf_rst","tfidf_tfidf","tfidf_rst")

# UC.06 Informationen visualisieren
head(myLSAspace.cosine.dist.hclust.alloc.combined)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(lsa.cosine = myLSAspace.cosine.dist.hclust.alloc.combined))
uc07_data(myLSAspace.cosine.dist.hclust.alloc.combined,"xlsx")
# write.xlsx(myLSAspace.cosine.dist.hclust.alloc.combined, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/myLSAspace.cosine.dist.hclust.alloc.combined_",cv,cc,".xlsx", sep=""))
```

## Latent Dirichlet Allocation (LDA) - topic- and kmeans-based clustering
### prepare for the creation of the LDA spaces
```{r}
# definitions
lda.gibbs.burnin <- 4000 # 1000
lda.gibbs.iter <- 2000 # 1000
lda.gibbs.thin <- 500 # 100
lda.gibbs.nstart <- 5
lda.gibbs.best <- T

lda.topics <- 30
# lda.topics <- cluster.cnt.overall

# The five most frequent terms for each topic are obtained by
most.frequent.topic.cont <- 5
most.frequent.term.cnt <- cluster.cnt.overall

lda.seed <- list(2003,5,63,100001,765)

#references:
# https://stackoverflow.com/questions/37802380/error-in-lda-in-r-each-row-of-the-input-matrix-needs-to-contain-at-least-one-no
dtm.tf.features.reducedby.tfidf.row.sum = apply(dtm.tf.features.reducedby.tfidf, 1, FUN = sum)
dtm.tf.features.reducedby.tfidf.entry.removed <- dtm.tf.features.reducedby.tfidf[dtm.tf.features.reducedby.tfidf.row.sum == 0,]$dimnames$Docs
dtm.tf.features.reducedby.tfidf = dtm.tf.features.reducedby.tfidf[dtm.tf.features.reducedby.tfidf.row.sum != 0,]

dtm.tf.features.reducedby.rst.row.sum = apply(dtm.tf.features.reducedby.rst, 1, FUN = sum)
dtm.tf.features.reducedby.rst.entry.removed <- dtm.tf.features.reducedby.rst[dtm.tf.features.reducedby.rst.row.sum == 0,]$dimnames$Docs
dtm.tf.features.reducedby.rst = dtm.tf.features.reducedby.rst[dtm.tf.features.reducedby.rst.row.sum != 0,]

dtm.tfidf.features.reducedby.tfidf.row.sum = apply(dtm.tfidf.features.reducedby.tfidf, 1, FUN = sum)
dtm.tfidf.features.reducedby.tfidf.entry.removed <- dtm.tfidf.features.reducedby.tfidf[dtm.tfidf.features.reducedby.tfidf.row.sum == 0,]$dimnames$Docs
dtm.tfidf.features.reducedby.tfidf = dtm.tfidf.features.reducedby.tfidf[dtm.tfidf.features.reducedby.tfidf.row.sum != 0,]

dtm.tfidf.features.reducedby.rst.row.sum = apply(dtm.tfidf.features.reducedby.rst, 1, FUN = sum)
dtm.tfidf.features.reducedby.rst.entry.removed <- dtm.tfidf.features.reducedby.rst[dtm.tfidf.features.reducedby.rst.row.sum == 0,]$dimnames$Docs
dtm.tfidf.features.reducedby.rst = dtm.tfidf.features.reducedby.rst[dtm.tfidf.features.reducedby.rst.row.sum != 0,]
```

### create the lda-spaces
```{r}

dtm.tf.features.reducedby.tfidf.lda.results = list(VEM = LDA(dtm.tf.features.reducedby.tfidf, k = lda.topics, control = list(seed = lda.seed)), VEM_fixed = LDA(dtm.tf.features.reducedby.tfidf, k = lda.topics, control = list(estimate.alpha = F, seed = lda.seed)), Gibbs = LDA(dtm.tf.features.reducedby.tfidf, k = lda.topics, method = "Gibbs", control = list(nstart = lda.gibbs.nstart, seed = lda.seed, burnin = lda.gibbs.burnin, thin = lda.gibbs.thin, iter = lda.gibbs.iter)), CTM = CTM(dtm.tf.features.reducedby.tfidf, k = lda.topics, control = list(seed = lda.seed, var = list(tol = 10^-4), em = list(tol = 10^-3))))

dtm.tf.features.reducedby.rst.lda.results = list(VEM = LDA(dtm.tf.features.reducedby.rst, k = lda.topics, control = list(seed = lda.seed)), VEM_fixed = LDA(dtm.tf.features.reducedby.rst, k = lda.topics, control = list(estimate.alpha = F, seed = lda.seed)), Gibbs = LDA(dtm.tf.features.reducedby.rst, k = lda.topics, method = "Gibbs", control = list(nstart = lda.gibbs.nstart, seed = lda.seed, burnin = lda.gibbs.burnin, thin = lda.gibbs.thin, iter = lda.gibbs.iter)), CTM = CTM(dtm.tf.features.reducedby.rst, k = lda.topics, control = list(seed = lda.seed, var = list(tol = 10^-4), em = list(tol = 10^-3))))

dtm.tfidf.features.reducedby.tfidf.lda.results = list(VEM = LDA(dtm.tfidf.features.reducedby.tfidf, k = lda.topics, control = list(seed = lda.seed)), VEM_fixed = LDA(dtm.tfidf.features.reducedby.tfidf, k = lda.topics, control = list(estimate.alpha = F, seed = lda.seed)), Gibbs = LDA(dtm.tfidf.features.reducedby.tfidf, k = lda.topics, method = "Gibbs", control = list(nstart = lda.gibbs.nstart, seed = lda.seed, burnin = lda.gibbs.burnin, thin = lda.gibbs.thin, iter = lda.gibbs.iter)), CTM = CTM(dtm.tfidf.features.reducedby.tfidf, k = lda.topics, control = list(seed = lda.seed, var = list(tol = 10^-4), em = list(tol = 10^-3))))

dtm.tfidf.features.reducedby.rst.lda.results = list(VEM = LDA(dtm.tfidf.features.reducedby.rst, k = lda.topics, control = list(seed = lda.seed)), VEM_fixed = LDA(dtm.tfidf.features.reducedby.rst, k = lda.topics, control = list(estimate.alpha = F, seed = lda.seed)), Gibbs = LDA(dtm.tfidf.features.reducedby.rst, k = lda.topics, method = "Gibbs", control = list(nstart = lda.gibbs.nstart, seed = lda.seed, burnin = lda.gibbs.burnin, thin = lda.gibbs.thin, iter = lda.gibbs.iter)), CTM = CTM(dtm.tfidf.features.reducedby.rst, k = lda.topics, control = list(seed = lda.seed, var = list(tol = 10^-4), em = list(tol = 10^-3))))

```

### determine the entropy measure for the selection of the appropriate lda-method
```{r}
# The entropy measure can also be used to indicate how the topic distributions differ for the four fitting methods. We determine the mean entropy for each fitted model over the documents. The term distribution for each topic as well as the predictive distribution of topics for a document can be obtained with posterior(). A list with components "terms" for the term distribution over topics and "topics" for the topic distributions over documents is returned.

dtm.tf.features.reducedby.tfidf.lda.results.entropy <- sapply(dtm.tf.features.reducedby.tfidf.lda.results, function(x) mean(apply(posterior(x)$topics,1, function(z) - sum(z * log(z)))))

dtm.tf.features.reducedby.rst.lda.results.entropy <- sapply(dtm.tf.features.reducedby.rst.lda.results, function(x) mean(apply(posterior(x)$topics,1, function(z) - sum(z * log(z)))))

dtm.tfidf.features.reducedby.tfidf.lda.results.entropy <- sapply(dtm.tfidf.features.reducedby.tfidf.lda.results, function(x) mean(apply(posterior(x)$topics,1, function(z) - sum(z * log(z)))))

dtm.tfidf.features.reducedby.rst.lda.results.entropy <- sapply(dtm.tfidf.features.reducedby.rst.lda.results, function(x) mean(apply(posterior(x)$topics,1, function(z) - sum(z * log(z)))))

lda.results.entropy <- data.frame(dtm.tf.features.reducedby.tfidf.lda.results.entropy,dtm.tfidf.features.reducedby.tfidf.lda.results.entropy, dtm.tf.features.reducedby.rst.lda.results.entropy, dtm.tfidf.features.reducedby.rst.lda.results.entropy)

# Higher values indicate that the topic distributions are more evenly spread over the topics.
colnames(lda.results.entropy) <- c("tf_tfidf_entropy","tf_rst_entropy","tfidf_tfidf_entropy","tfidf_rst_entropy")

# select the lda-Method manually
lda.topic.entropy.selector <- c("VEM_fixed")

# UC.06 Informationen visualisieren
mean_value <- apply(lda.results.entropy, 1, FUN = mean)
lda.results.entropy <- cbind(lda.results.entropy, mean_value)
lda.results.entropy

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(lda.entropy = lda.results.entropy))
uc07_data(lda.results.entropy,"xlsx")
# write.xlsx(lda.results.entropy, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/lda.results.entropy_",cv,cc,".xlsx", sep=""))
```

### determine the cluster tendency
```{r}
dtm.tf.features.reducedby.tfidf.lda.gct <- get_clust_tendency(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, nrow(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma)-1, seed = 1234)
dtm.tf.features.reducedby.rst.lda.gct <- get_clust_tendency(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, nrow(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma)-1, seed = 1234)
dtm.tfidf.features.reducedby.tfidf.lda.gct <- get_clust_tendency(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, nrow(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma)-1, seed = 1234)
dtm.tfidf.features.reducedby.rst.lda.gct <- get_clust_tendency(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, nrow(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma)-1, seed = 1234)

dtm.tf_tfidf.lda.gct <- data.frame(LDA_ClusterTendency = c(dtm.tf.features.reducedby.tfidf.lda.gct$hopkins_stat,dtm.tf.features.reducedby.rst.lda.gct$hopkins_stat,dtm.tfidf.features.reducedby.tfidf.lda.gct$hopkins_stat,dtm.tfidf.features.reducedby.rst.lda.gct$hopkins_stat), row.names = c("tf_tfidf","tf_rst","tfidf_tfidf","tfidf_rst"))
dtm.tf_tfidf.lda.gct <- t(dtm.tf_tfidf.lda.gct)

# UC.06 Informationen visualisieren
overall.gct <- data.frame(tdm.tf_tfidf.gct)
overall.gct <- rbind(overall.gct, tdm.tf_tfidf.myLSAspace.gct)
overall.gct <- rbind(overall.gct, dtm.tf_tfidf.lda.gct)
overall.gct

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(overall.gct = overall.gct))
uc07_data(overall.gct,"xlsx")
# write.xlsx(overall.gct, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/overall.gct_",cv,cc,".xlsx", sep=""))

```

### retrieve the lda-topics
```{r}
# The estimated topics for a document and estimated terms for a topic can be obtained using the convenience functions topics() and terms(). The most likely topic for each document is obtained by

dtm.tf.features.reducedby.tfidf.lda.topic <- topics(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]],1)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tf_tfidf.lda.topic = dtm.tf.features.reducedby.tfidf.lda.topic))
uc07_data(dtm.tf.features.reducedby.tfidf.lda.topic,"xlsx")
# write.xlsx(dtm.tf.features.reducedby.tfidf.lda.topic, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tf.features.reducedby.tfidf.lda.topic_",cv,cc,".xlsx", sep=""))

dtm.tf.features.reducedby.rst.lda.topic <- topics(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]],1)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tf_rst.lda.topic = dtm.tf.features.reducedby.rst.lda.topic))
uc07_data(dtm.tf.features.reducedby.rst.lda.topic,"xlsx")
# write.xlsx(dtm.tf.features.reducedby.rst.lda.topic, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tf.features.reducedby.rst.lda.topic_",cv,cc,".xlsx", sep=""))

dtm.tfidf.features.reducedby.tfidf.lda.topic <- topics(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]],1)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tfidf_tfidf.lda.topic = dtm.tfidf.features.reducedby.tfidf.lda.topic))
uc07_data(dtm.tfidf.features.reducedby.tfidf.lda.topic,"xlsx")
# write.xlsx(dtm.tfidf.features.reducedby.tfidf.lda.topic, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tfidf.features.reducedby.tfidf.lda.topic_",cv,cc,".xlsx", sep=""))

dtm.tfidf.features.reducedby.rst.lda.topic <- topics(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]],1)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tfidf_rst.lda.topic = dtm.tfidf.features.reducedby.rst.lda.topic))
uc07_data(dtm.tfidf.features.reducedby.rst.lda.topic,"xlsx")
# write.xlsx(dtm.tfidf.features.reducedby.rst.lda.topic, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tf.features.reducedby.tfidf.lda.topic_",cv,cc,".xlsx", sep=""))

dtm.tf.features.reducedby.tfidf.lda.topic.terms <- topicmodels::terms(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]],most.frequent.topic.cont)

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.tfidf.lda.topic.terms[,1:most.frequent.term.cnt]

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tf_tfidf.lda.term = dtm.tf.features.reducedby.tfidf.lda.topic.terms))
uc07_data(dtm.tf.features.reducedby.tfidf.lda.topic.terms,"xlsx")
# write.xlsx(dtm.tf.features.reducedby.tfidf.lda.topic.terms, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tf.features.reducedby.tfidf.lda.topic.terms_",cv,cc,".xlsx", sep=""))

dtm.tfidf.features.reducedby.tfidf.lda.topic.terms <- topicmodels::terms(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]],most.frequent.topic.cont)

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.tfidf.lda.topic.terms[,1:most.frequent.term.cnt]

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tfidf_tfidf.lda.term = dtm.tfidf.features.reducedby.tfidf.lda.topic.terms))
uc07_data(dtm.tfidf.features.reducedby.tfidf.lda.topic.terms,"xlsx")
# write.xlsx(dtm.tfidf.features.reducedby.tfidf.lda.topic.terms, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tfidf.features.reducedby.tfidf.lda.topic.terms_",cv,cc,".xlsx", sep=""))

dtm.tf.features.reducedby.rst.lda.topic.terms <- topicmodels::terms(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]],most.frequent.topic.cont)

# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.rst.lda.topic.terms[,1:most.frequent.term.cnt]

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tf_rst.lda.term = dtm.tf.features.reducedby.rst.lda.topic.terms))
uc07_data(dtm.tf.features.reducedby.rst.lda.topic.terms,"xlsx")
# write.xlsx(dtm.tf.features.reducedby.rst.lda.topic.terms, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tf.features.reducedby.rst.lda.topic.terms_",cv,cc,".xlsx", sep=""))

dtm.tfidf.features.reducedby.rst.lda.topic.terms <- topicmodels::terms(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]],most.frequent.topic.cont)

# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.rst.lda.topic.terms[,1:most.frequent.term.cnt]

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tfidf_rst.lda.term = dtm.tfidf.features.reducedby.rst.lda.topic.terms))
uc07_data(dtm.tfidf.features.reducedby.rst.lda.topic.terms,"xlsx")
# write.xlsx(dtm.tfidf.features.reducedby.rst.lda.topic.terms, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tfidf.features.reducedby.rst.lda.topic.terms_",cv,cc,".xlsx", sep=""))

# If any category labelings of the documents were available, these could be used to validate the fitted model.
```

### lda topic- and kmeans-based clustering 
#### for dtm.tf.features.reducedby.tfidf and dtm.tf.features.reducedby.rst
```{r}
dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster <- as.data.frame(topics(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]],1))

set.seed(1234)

# kmeans algorithm
dtm.tf.features.reducedby.tfidf.lda.results.kmeans.cluster <- kmeans(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, cluster.cnt.overall, nstart = 25)

# pseudo cluster allocation
dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster <- cbind(dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster, dtm.tf.features.reducedby.tfidf.lda.results.kmeans.cluster$cluster)

colnames(dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster) <- c("lda_topic_cluster","lda_kmeans_cluster")

# UC.06 Informationen visualisieren
head(dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tf_tfidf.lda.pc = dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster))
uc07_data(dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster,"xlsx")
# write.xlsx(dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster_",cv,cc,".xlsx", sep=""))

# pseudo cluster allocation
dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster <- as.data.frame(topics(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]],1))

# kmeans algorithm
set.seed(1234)
dtm.tf.features.reducedby.rst.lda.results.kmeans.cluster <- kmeans(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, cluster.cnt.overall, nstart = 25)

dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster <- cbind(dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster, dtm.tf.features.reducedby.rst.lda.results.kmeans.cluster$cluster)

colnames(dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster) <- c("lda_topic_cluster","lda_kmeans_cluster")

# UC.06 Informationen visualisieren
head(dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tf_rst.lda.pc = dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster))
uc07_data(dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster,"xlsx")
# write.xlsx(dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster_",cv,cc,".xlsx", sep=""))


```

#### for dtm.tfidf.features.reducedby.tfidf
```{r}
# pseudo cluster allocation
dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster <- as.data.frame(topics(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]],1))

# kmeans algorithm
set.seed(1234)
dtm.tfidf.features.reducedby.tfidf.lda.results.kmeans.cluster <- kmeans(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, cluster.cnt.overall, nstart = 25)

dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster <- cbind(dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster, dtm.tfidf.features.reducedby.tfidf.lda.results.kmeans.cluster$cluster)

colnames(dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster) <- c("lda_topic_cluster","lda_kmeans_cluster")

# UC.06 Informationen visualisieren
head(dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tfidf_tfidf.lda.pc = dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster))
uc07_data(dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster,"xlsx")
# write.xlsx(dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster_",cv,cc,".xlsx", sep=""))
```

#### for dtm.tfidf.features.reducedby.rst
```{r}
# pseudo cluster allocation
dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster <- as.data.frame(topics(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]],1))

# kmeans algorith
set.seed(1234)
dtm.tfidf.features.reducedby.rst.lda.results.kmeans.cluster <- kmeans(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, cluster.cnt.overall, nstart = 25)

dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster <- cbind(dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster, dtm.tfidf.features.reducedby.rst.lda.results.kmeans.cluster$cluster)

colnames(dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster) <- c("lda_topic_cluster","lda_kmeans_cluster")

# UC.06 Informationen visualisieren
head(dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(dtm.tfidf_rst.lda.pc = dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster))
uc07_data(dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster,"xlsx")
# write.xlsx(dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster_",cv,cc,".xlsx", sep=""))
```

#### visualize the cluster results for dtm.tf.features.reducedby.tfidf
```{r, fig.height=20, fig.width=20}
# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.tfidf.lda.results.kmeans.cluster.plot <- fviz_cluster(dtm.tf.features.reducedby.tfidf.lda.results.kmeans.cluster, data = dtm.tf.features.reducedby.tfidf, na.rm = T) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tf.features.reducedby.tfidf; LDA with kmeans; k =", lda.topics))
dtm.tf.features.reducedby.tfidf.lda.results.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.tfidf.lda.results.kmeans.cluster.plot_",cv,cc,".png", sep = ""), plot = dtm.tf.features.reducedby.tfidf.lda.results.kmeans.cluster.plot, dpi = 300)
```
#### visualize the cluster results for dtm.tf.features.reducedby.rst
```{r, fig.height=20, fig.width=20}
# UC.06 Informationen visualisieren
dtm.tf.features.reducedby.rst.lda.results.kmeans.cluster.plot <- fviz_cluster(dtm.tf.features.reducedby.rst.lda.results.kmeans.cluster, data = dtm.tf.features.reducedby.rst, na.rm = T) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tfidf.features.reducedby.rst; LDA with kmeans; k =", lda.topics))
dtm.tf.features.reducedby.rst.lda.results.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tf.features.reducedby.rst.lda.results.kmeans.cluster.plot_",cv,cc,".png", sep = ""), plot = dtm.tf.features.reducedby.rst.lda.results.kmeans.cluster.plot, dpi = 300)

```
#### visualize the cluster results for dtm.tfidf.features.reducedby.tfidf
```{r, fig.height=20, fig.width=20}
# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.tfidf.lda.results.kmeans.cluster.plot <- fviz_cluster(dtm.tfidf.features.reducedby.tfidf.lda.results.kmeans.cluster, data = dtm.tfidf.features.reducedby.tfidf, na.rm = T) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tfidf.features.reducedby.tfidf; LDA with kmeans; k =", lda.topics))
dtm.tfidf.features.reducedby.tfidf.lda.results.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.tfidf.lda.results.kmeans.cluster.plot_",cv,cc,".png", sep = ""), plot = dtm.tfidf.features.reducedby.tfidf.lda.results.kmeans.cluster.plot, dpi = 300)
```
#### visualize the cluster results for dtm.tfidf.features.reducedby.rst
```{r, fig.height=20, fig.width=20}
# UC.06 Informationen visualisieren
dtm.tfidf.features.reducedby.rst.lda.results.kmeans.cluster.plot <- fviz_cluster(dtm.tfidf.features.reducedby.rst.lda.results.kmeans.cluster, data = dtm.tfidf.features.reducedby.rst, na.rm = T) +ggtitle("Determination of cluster members", subtitle = paste("Cluster plot; tdm.tfidf.features.reducedby.rst; LDA with kmeans; k =", lda.topics))
dtm.tfidf.features.reducedby.rst.lda.results.kmeans.cluster.plot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/dtm.tfidf.features.reducedby.rst.lda.results.kmeans.cluster.plot_",cv,cc,".png", sep = ""), plot = dtm.tfidf.features.reducedby.rst.lda.results.kmeans.cluster.plot, dpi = 300)

```
#### retrieve the results for lda-topic based clustering
```{r}
# for the topic based clustering
dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster.temp <- dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster[row.names(dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster) != dtm.tf.features.reducedby.tfidf.entry.removed,]

dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster.temp <-dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster[row.names(dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster) != dtm.tf.features.reducedby.tfidf.entry.removed,]

lda.pseudo.cluster.alloc.combined <- data.frame(subset(dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster, select = c("lda_topic_cluster")))
lda.pseudo.cluster.alloc.combined <- cbind(lda.pseudo.cluster.alloc.combined, subset(dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster.temp, select = c("lda_topic_cluster")))
lda.pseudo.cluster.alloc.combined <- cbind(lda.pseudo.cluster.alloc.combined, subset(dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster, select = c("lda_topic_cluster")))
lda.pseudo.cluster.alloc.combined <- cbind(lda.pseudo.cluster.alloc.combined, subset(dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster.temp, select = c("lda_topic_cluster")))
colnames(lda.pseudo.cluster.alloc.combined) <- c("tf_tfidf", "tf_rst","tfidf_tfidf","tfidf_rst")

# UC.06 Informationen visualisieren
head(lda.pseudo.cluster.alloc.combined)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(lda.pc = lda.pseudo.cluster.alloc.combined))
uc07_data(lda.pseudo.cluster.alloc.combined,"xlsx")
# write.xlsx(lda.pseudo.cluster.alloc.combined, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/lda.pseudo.cluster.alloc.combined_",cv,cc,".xlsx", sep=""))

# for the kmeans based clustering
lda.kmeans.cluster.alloc.combined <- data.frame(subset(dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster, select = c("lda_kmeans_cluster")))
lda.kmeans.cluster.alloc.combined <- cbind(lda.kmeans.cluster.alloc.combined, subset(dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster.temp, select = c("lda_kmeans_cluster")))
lda.kmeans.cluster.alloc.combined <- cbind(lda.kmeans.cluster.alloc.combined, subset(dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster, select = c("lda_kmeans_cluster")))
lda.kmeans.cluster.alloc.combined <- cbind(lda.kmeans.cluster.alloc.combined, subset(dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster.temp, select = c("lda_kmeans_cluster")))
colnames(lda.kmeans.cluster.alloc.combined) <- c("tf_tfidf", "tf_rst","tfidf_tfidf","tfidf_rst")

# UC.06 Informationen visualisieren
head(lda.kmeans.cluster.alloc.combined)

# UC.07 Informationen austauschen
uc04_xlsx_list <- append(uc04_xlsx_list, list(lda.kmeans = lda.kmeans.cluster.alloc.combined))
uc07_data(lda.kmeans.cluster.alloc.combined,"xlsx")
# write.xlsx(lda.kmeans.cluster.alloc.combined, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/lda.kmeans.cluster.alloc.combined_",cv,cc,".xlsx", sep=""))

```

## save the data as xlsx files
```{r}
uc04_wb = createWorkbook(type = "xlsx")

for (item in 1:length(uc04_xlsx_list)) {
  sheet = createSheet(uc04_wb, sheetName = names(uc04_xlsx_list)[item])
  addDataFrame(as.data.frame(uc04_xlsx_list[[item]]), sheet = sheet)
}

saveWorkbook(uc04_wb,paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/uc04_wb_",cv,".xlsx", sep=""))

```


# UC.05 Ergebnisse der Zusammenhangs-Analyse evaluieren
## definition area
### a list to store all UC.03 related xlsx based data
```{r}
uc05_xlsx_list <- list()
```

## prepare the cluster results for further processing
```{r}
# merge all the clustering results
cluster.alloc.df.combined <- data.frame(cosine.sim.dist.hclust.alloc.df.combined)
cluster.alloc.df.combined <- cbind(cluster.alloc.df.combined,kmeans.cluster.alloc.combined)
cluster.alloc.df.combined <- cbind(cluster.alloc.df.combined,kmedoids.cluster.alloc.combined)
cluster.alloc.df.combined <- cbind(cluster.alloc.df.combined,myLSAspace.kmeans.cluster.alloc.combined)
cluster.alloc.df.combined <- cbind(cluster.alloc.df.combined,myLSAspace.cosine.dist.hclust.alloc.combined)

cluster.alloc.df.combined.temp <- cluster.alloc.df.combined

cluster.alloc.df.combined <- cluster.alloc.df.combined[row.names(cluster.alloc.df.combined) != dtm.tf.features.reducedby.tfidf.entry.removed,]

cluster.alloc.df.combined <- cbind(cluster.alloc.df.combined,lda.pseudo.cluster.alloc.combined)
cluster.alloc.df.combined <- cbind(cluster.alloc.df.combined,lda.kmeans.cluster.alloc.combined)
colnames(cluster.alloc.df.combined) <- c("cos_tf_tfidf","cos_tf_rst","cos_tfidf_tfidf","cos_tfidf_rst","kmea_tf_tfidf","kmea_tf_rst","kmea_tfidf_tfidf","kmea_tfidf_rst","kmed_tf_tfidf","kmed_tf_rst","kmed_tfidf_tfidf","kmed_tfidf_rst","lsa_kmea_tf_tfidf","lsa_kmea_tf_rst","lsa_kmea_tfidf_tfidf","lsa_kmea_tfidf_rst","lsa_cos_tf_tfidf","lsa_cos_tf_rst","lsa_cos_tfidf_tfidf","lsa_cos_tfidf_rst","lda_topic_tf_tfidf","lda_topic_tf_rst","lda_topic_tfidf_tfidf","lda_topic_tfidf_rst","lda_kmea_tf_tfidf","lda_kmea_tf_rst","lda_kmea_tfidf_tfidf","lda_kmea_tfidf_rst")

# UC.06 Informationen visualisieren
head(cluster.alloc.df.combined)

# UC.07 Informationen austauschen

uc05_xlsx_list <- append(uc05_xlsx_list, list(cluster = cluster.alloc.df.combined))
uc07_data(cluster.alloc.df.combined,"xlsx")
# write.xlsx(cluster.alloc.df.combined, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/cluster.alloc.df.combined_",cv,cc,".xlsx", sep=""))

```

## The Rand index
### index calculation
```{r}
# calculate the rand index for cluster allocations

cluster.alloc.df.combined.rand <- data.frame()
# first <- character()

for (item1 in 1:ncol(cluster.alloc.df.combined)) { for (item2 in 1:ncol(cluster.alloc.df.combined)) { cluster.alloc.df.combined.rand[item1,item2] <- rand.index(cluster.alloc.df.combined[,item1],cluster.alloc.df.combined[,item2])}}

colnames(cluster.alloc.df.combined.rand) <- c("cos_tf_tfidf","cos_tf_rst","cos_tfidf_tfidf","cos_tfidf_rst","kmea_tf_tfidf","kmea_tf_rst","kmea_tfidf_tfidf","kmea_tfidf_rst","kmed_tf_tfidf","kmed_tf_rst","kmed_tfidf_tfidf","kmed_tfidf_rst","lsa_kmea_tf_tfidf","lsa_kmea_tf_rst","lsa_kmea_tfidf_tfidf","lsa_kmea_tfidf_rst","lsa_cos_tf_tfidf","lsa_cos_tf_rst","lsa_cos_tfidf_tfidf","lsa_cos_tfidf_rst","lda_topic_tf_tfidf","lda_topic_tf_rst","lda_topic_tfidf_tfidf","lda_topic_tfidf_rst","lda_kmea_tf_tfidf","lda_kmea_tf_rst","lda_kmea_tfidf_tfidf","lda_kmea_tfidf_rst")

# 
rownames(cluster.alloc.df.combined.rand) <- c("cos_tf_tfidf","cos_tf_rst","cos_tfidf_tfidf","cos_tfidf_rst","kmea_tf_tfidf","kmea_tf_rst","kmea_tfidf_tfidf","kmea_tfidf_rst","kmed_tf_tfidf","kmed_tf_rst","kmed_tfidf_tfidf","kmed_tfidf_rst","lsa_kmea_tf_tfidf","lsa_kmea_tf_rst","lsa_kmea_tfidf_tfidf","lsa_kmea_tfidf_rst","lsa_cos_tf_tfidf","lsa_cos_tf_rst","lsa_cos_tfidf_tfidf","lsa_cos_tfidf_rst","lda_topic_tf_tfidf","lda_topic_tf_rst","lda_topic_tfidf_tfidf","lda_topic_tfidf_rst","lda_kmea_tf_tfidf","lda_kmea_tf_rst","lda_kmea_tfidf_tfidf","lda_kmea_tfidf_rst")
```

```{r}
# calculate the rand index for cluster allocations

cluster.alloc.df.combined.rand.temp <- data.frame()
df <- cluster.alloc.df.combined[,c(4,8,12,16,20,24,28)]
# first <- character()

for (item1 in 1:ncol(df)) { for (item2 in 1:ncol(df)) { cluster.alloc.df.combined.rand.temp[item1,item2] <- rand.index(df[,item1],df[,item2])}}

colnames(cluster.alloc.df.combined.rand.temp) <- c("cos_tfidf_rst","kmea_tfidf_rst","kmed_tfidf_rst","lsa_kmea_tfidf_rst","lsa_cos_tfidf_rst","lda_topic_tfidf_rst","lda_kmea_tfidf_rst")

# 
rownames(cluster.alloc.df.combined.rand.temp) <- c("cos_tfidf_rst","kmea_tfidf_rst","kmed_tfidf_rst","lsa_kmea_tfidf_rst","lsa_cos_tfidf_rst","lda_topic_tfidf_rst","lda_kmea_tfidf_rst")
```

### visualize the rand indices
```{r, fig.height=12, fig.width=12}
# UC.06 Informationen visualisieren
# http://www.sthda.com/english/wiki/correlation-matrix-a-quick-start-guide-to-analyze-format-and-visualize-a-correlation-matrix-using-r-software

# for cluster.alloc.df.combined.rand.data

cluster.alloc.df.combined.rand.data <- round(cluster.alloc.df.combined.rand,2)

cluster.alloc.df.combined.rand.ggcorplot <- ggcorrplot(cluster.alloc.df.combined.rand.data, method = "circle") +ggtitle("Evaluation of cluster allocations", subtitle = paste("Correlation plot; RAND index; complete data; k =", cluster.cnt.overall))

cluster.alloc.df.combined.rand.ggcorplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/cluster.alloc.df.combined.rand.ggcorplot_",cv,cc,".png", sep = ""), dpi = 300, plot = cluster.alloc.df.combined.rand.ggcorplot, limitsize = F)

uc05_xlsx_list <- append(uc05_xlsx_list, list(rand = cluster.alloc.df.combined.rand.data))
uc07_data(cluster.alloc.df.combined.rand.data,"xlsx")
# write.xlsx(cluster.alloc.df.combined.rand.data, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/cluster.alloc.df.combined.rand.data_",cv,cc,".xlsx", sep=""))

```

```{r, fig.height=6, fig.width=6}
cluster.alloc.df.combined.rand.temp.data <- round(cluster.alloc.df.combined.rand.temp,2)

cluster.alloc.df.combined.rand.temp.ggcorplot <- ggcorrplot(cluster.alloc.df.combined.rand.temp.data, lab = T) +ggtitle("Evaluation of cluster allocations", subtitle = paste("Correlation plot; RAND index; complete data; k =", cluster.cnt.overall))

cluster.alloc.df.combined.rand.temp.ggcorplot

# UC.07 Informationen austauschen
ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/cluster.alloc.df.combined.rand.temp.ggcorplot_",cv,cc,".png", sep = ""), dpi = 300, plot = cluster.alloc.df.combined.rand.temp.ggcorplot, limitsize = F)

uc07_data(cluster.alloc.df.combined.rand.temp.data,"xlsx")
# write.xlsx(cluster.alloc.df.combined.rand.temp.data, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/cluster.alloc.df.combined.rand.temp.data_",cv,cc,".xlsx", sep=""))

```

## The Davies-Boulding index
### index calculation
```{r}

# If we fix the distance between clusters but make the cases within each cluster more spread out, the Davies-Bouldin index will get larger. Conversely, if we fix the within-cluster variance but move the clusters farther apart from each other, the index will get smaller. In theory, the smaller the value (which is bounded between zero and infinity), the better the separation between clusters. https://livebook.manning.com/concept/r/davies-bouldin-index

# https://search.r-project.org/CRAN/refmans/clusterSim/html/index.DB.html
# https://livebook.manning.com/concept/r/davies-bouldin-index
# https://www.rdocumentation.org/packages/clusterSim/versions/0.50-1/topics/index.DB

# for cosine
cosine.sim.cluster.dbi <- list(index.DB(tdm.tf.features.reducedby.tfidf.cosine.sim, tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df$cluster_number, centrotypes = "centroids"), index.DB(tdm.tf.features.reducedby.rst.cosine.sim, tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df$cluster_number, centrotypes = "centroids"), index.DB(tdm.tfidf.features.reducedby.tfidf.cosine.sim, tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df$cluster_number, centrotypes = "centroids"), index.DB(tdm.tfidf.features.reducedby.rst.cosine.sim, tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df$cluster_number, centrotypes = "centroids"))

# for kmeans
kmeans.cluster.dbi <- list(index.DB(dtm.tf.features.reducedby.tfidf.matrix.df,dtm.tf.features.reducedby.tfidf.matrix.df.kmeans$cluster, d = NULL, centrotypes = "centroids"), index.DB(dtm.tf.features.reducedby.rst.matrix.df,dtm.tf.features.reducedby.rst.matrix.df.kmeans$cluster, d = NULL, centrotypes = "centroids"), index.DB(dtm.tf.features.reducedby.rst.matrix.df,dtm.tf.features.reducedby.rst.matrix.df.kmeans$cluster, d = NULL, centrotypes = "centroids"), index.DB(dtm.tfidf.features.reducedby.rst.matrix.df,dtm.tf.features.reducedby.rst.matrix.df.kmeans$cluster, d = NULL, centrotypes = "centroids"))

# for kmedoids
pam.cluster.dbi <- list(index.DB(dtm.tf.features.reducedby.tfidf.matrix.df, dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids$clustering, d = dist(dtm.tf.features.reducedby.tfidf.matrix.df), centrotypes = "medoids"), index.DB(dtm.tf.features.reducedby.rst.matrix.df, dtm.tf.features.reducedby.rst.matrix.df.kmedoids$clustering, d = dist(dtm.tf.features.reducedby.rst.matrix.df), centrotypes = "medoids"), index.DB(dtm.tfidf.features.reducedby.tfidf.matrix.df, dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids$clustering, d = dist(dtm.tfidf.features.reducedby.tfidf.matrix.df), centrotypes = "medoids"), index.DB(dtm.tfidf.features.reducedby.rst.matrix.df, dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids$clustering, d = dist(dtm.tfidf.features.reducedby.rst.matrix.df), centrotypes = "medoids"))

# for lsa with kmeans
myLSAspace.kmeans.cluster.dbi <- list(index.DB(tdm.tf.features.reducedby.tfidf.myLSAspace$dk, tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans$cluster, d = NULL, centrotypes = "centroids"), index.DB(tdm.tf.features.reducedby.rst.myLSAspace$dk, tdm.tf.features.reducedby.rst.myLSAspace.kmeans$cluster, d = NULL, centrotypes = "centroids"), index.DB(tdm.tfidf.features.reducedby.tfidf.myLSAspace$dk, tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans$cluster, d = NULL, centrotypes = "centroids"), index.DB(tdm.tfidf.features.reducedby.rst.myLSAspace$dk, tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans$cluster, d = NULL, centrotypes = "centroids"))

# for lsa with cosine distance
myLSAspace.cosine.cluster.dbi <- list(index.DB(tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist, tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df$cluster_number, d = NULL, centrotypes = "centroids"), index.DB(tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist, tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df$cluster_number, d = NULL, centrotypes = "centroids"), index.DB(tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist, tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df$cluster_number, d = NULL, centrotypes = "centroids"), index.DB(tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist, tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df$cluster_number, d = NULL, centrotypes = "centroids"))

# for lda with topic cluster
lda.topic.cluster.dbi <- list(index.DB(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster$lda_topic_cluster, d = NULL, centrotypes = "centroids"), index.DB(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster$lda_topic_cluster, d = NULL, centrotypes = "centroids"), index.DB(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster$lda_topic_cluster, d = NULL, centrotypes = "centroids"), index.DB(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster$lda_topic_cluster, d = NULL, centrotypes = "centroids"))

# for lda with kmeans
lda.kmeans.cluster.dbi <- list(index.DB(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tf.features.reducedby.tfidf.lda.results.kmeans.cluster$cluster, d = NULL, centrotypes = "centroids"), index.DB(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tf.features.reducedby.rst.lda.results.kmeans.cluster$cluster, d = NULL, centrotypes = "centroids"), index.DB(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tfidf.features.reducedby.tfidf.lda.results.kmeans.cluster$cluster, d = NULL, centrotypes = "centroids"), index.DB(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tfidf.features.reducedby.rst.lda.results.kmeans.cluster$cluster, d = NULL, centrotypes = "centroids"))

# merge all results together
cluster.dbi <- list(cosine.sim.cluster.dbi,kmeans.cluster.dbi,pam.cluster.dbi, myLSAspace.kmeans.cluster.dbi, myLSAspace.cosine.cluster.dbi, lda.topic.cluster.dbi,lda.kmeans.cluster.dbi)

```

### visualize the results
```{r}
# prepare the results for "The Davies-Boulding index"

cluster.alloc.df.combined.dbi.data <- round(data.frame(cosine = c(cluster.dbi[[1]][[1]]$DB, cluster.dbi[[1]][[2]]$DB,cluster.dbi[[1]][[3]]$DB,cluster.dbi[[1]][[4]]$DB), kmeans = c(cluster.dbi[[2]][[1]]$DB, cluster.dbi[[2]][[2]]$DB,cluster.dbi[[2]][[3]]$DB,cluster.dbi[[2]][[4]]$DB), kmedoids = c(cluster.dbi[[3]][[1]]$DB, cluster.dbi[[3]][[2]]$DB,cluster.dbi[[3]][[3]]$DB,cluster.dbi[[3]][[4]]$DB), lsa = c(cluster.dbi[[4]][[1]]$DB, cluster.dbi[[4]][[2]]$DB,cluster.dbi[[4]][[3]]$DB,cluster.dbi[[4]][[4]]$DB), lsa_cosine = c(cluster.dbi[[5]][[1]]$DB, cluster.dbi[[5]][[2]]$DB,cluster.dbi[[5]][[3]]$DB,cluster.dbi[[5]][[4]]$DB), lda_topic = c(cluster.dbi[[6]][[1]]$DB, cluster.dbi[[6]][[2]]$DB,cluster.dbi[[6]][[3]]$DB,cluster.dbi[[6]][[4]]$DB), lda_kmeans = c(cluster.dbi[[7]][[1]]$DB, cluster.dbi[[7]][[2]]$DB,cluster.dbi[[7]][[3]]$DB,cluster.dbi[[7]][[4]]$DB), row.names = c("tf_tfidf","tf_rst","tfidf_tfidf","tfidf_rst")),2)

# UC.06 Informationen visualisieren
print(cluster.alloc.df.combined.dbi.data)

# UC.07 Informationen austauschen
uc05_xlsx_list <- append(uc05_xlsx_list, list(dbi = cluster.alloc.df.combined.dbi.data))
uc07_data(cluster.alloc.df.combined.dbi.data,"xlsx")
# write.xlsx(cluster.alloc.df.combined.dbi.data, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/cluster.alloc.df.combined.dbi.data_",cv,cc,".xlsx", sep=""))

```

## The Calinski-Harabasz index
### index calculation
```{r}
# https://search.r-project.org/CRAN/refmans/fpc/html/calinhara.html
# https://saltfarmer.github.io/blog/machine%20learning/Evaluation-Metrics-Clustering/

# If the ground truth labels are not known, the Calinski-Harabasz index also known as the Variance Ratio Criterion - can be used to evaluate the model, where a higher Calinski-Harabasz score relates to a model with better defined clusters. The index is the ratio of the sum of between-clusters dispersion and of inter-cluster dispersion for all clusters (where dispersion is defined as the sum of distances squared).

# for cosine
cosine.sim.cluster.chi <- list(calinhara(tdm.tf.features.reducedby.tfidf.cosine.sim,tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df$cluster_number), calinhara(tdm.tf.features.reducedby.rst.cosine.sim,tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df$cluster_number), calinhara(tdm.tfidf.features.reducedby.tfidf.cosine.sim,tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df$cluster_number), calinhara(tdm.tfidf.features.reducedby.rst.cosine.sim,tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df$cluster_number))

# for kmeans
kmeans.cluster.chi <- list(calinhara(dtm.tf.features.reducedby.tfidf.matrix.df,dtm.tf.features.reducedby.tfidf.matrix.df.kmeans$cluster), calinhara(dtm.tf.features.reducedby.rst.matrix.df,dtm.tf.features.reducedby.rst.matrix.df.kmeans$cluster), calinhara(dtm.tfidf.features.reducedby.tfidf.matrix.df,dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans$cluster), calinhara(dtm.tfidf.features.reducedby.rst.matrix.df,dtm.tfidf.features.reducedby.rst.matrix.df.kmeans$cluster))

# for kmedoids
pam.cluster.chi <- list(calinhara(dtm.tf.features.reducedby.tfidf.matrix.df,dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids$clustering), calinhara(dtm.tf.features.reducedby.rst.matrix.df,dtm.tf.features.reducedby.rst.matrix.df.kmedoids$clustering), calinhara(dtm.tf.features.reducedby.tfidf.matrix.df,dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids$clustering), calinhara(dtm.tf.features.reducedby.rst.matrix.df,dtm.tf.features.reducedby.rst.matrix.df.kmedoids$clustering))

# for lsa with kmeans
myLSAspace.kmeans.cluster.chi <- list(calinhara(tdm.tf.features.reducedby.tfidf.myLSAspace$dk, tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans$cluster), calinhara(tdm.tf.features.reducedby.rst.myLSAspace$dk, tdm.tf.features.reducedby.rst.myLSAspace.kmeans$cluster), calinhara(tdm.tf.features.reducedby.tfidf.myLSAspace$dk, tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans$cluster), calinhara(tdm.tf.features.reducedby.rst.myLSAspace$dk, tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans$cluster))

# for lsa with cosine distance
myLSAspace.cosine.cluster.chi <- list(cluster.stats(d= tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist, tdm.tf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df$cluster_number), cluster.stats(d= tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist, tdm.tf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df$cluster_number), cluster.stats(d= tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist, tdm.tfidf.features.reducedby.tfidf.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df$cluster_number), cluster.stats(d= tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist, tdm.tfidf.features.reducedby.rst.myLSAspace.lsaMatrix.cosine.dist.hclust.alloc.df$cluster_number))

# lda with topic cluster
lda.topic.cluster.chi <- list(calinhara(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster$lda_topic_cluster), calinhara(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster$lda_topic_cluster), calinhara(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster$lda_topic_cluster), calinhara(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster$lda_topic_cluster))

# lda with kmeans
lda.kmeans.cluster.chi <- list(calinhara(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tf.features.reducedby.tfidf.lda.results.kmeans.cluster$cluster), calinhara(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tf.features.reducedby.rst.lda.results.kmeans.cluster$cluster), calinhara(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tfidf.features.reducedby.tfidf.lda.results.kmeans.cluster$cluster), calinhara(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma, dtm.tfidf.features.reducedby.rst.lda.results.kmeans.cluster$cluster))

# merge all results together
cluster.chi <- list(cosine.sim.cluster.chi,kmeans.cluster.chi,pam.cluster.chi, myLSAspace.kmeans.cluster.chi, myLSAspace.cosine.cluster.chi, lda.topic.cluster.chi,lda.kmeans.cluster.chi)

```

### prepare and visualize the results
```{r}

cluster.alloc.df.combined.chi.data <- round(data.frame(cosine = c(cluster.chi[[1]][[1]], cluster.chi[[1]][[2]],cluster.chi[[1]][[3]],cluster.chi[[1]][[4]]), kmeans = c(cluster.chi[[2]][[1]], cluster.chi[[2]][[2]],cluster.chi[[2]][[3]],cluster.chi[[2]][[4]]), kmedoids = c(cluster.chi[[3]][[1]], cluster.chi[[3]][[2]],cluster.chi[[3]][[3]],cluster.chi[[3]][[4]]), lsa = c(cluster.chi[[4]][[1]], cluster.chi[[4]][[2]],cluster.chi[[4]][[3]],cluster.chi[[4]][[4]]), lsa_cosine = c(cluster.chi[[5]][[1]]$ch, cluster.chi[[5]][[2]]$ch,cluster.chi[[5]][[3]]$ch,cluster.chi[[5]][[4]]$ch), lda_topic = c(cluster.chi[[6]][[1]], cluster.chi[[6]][[2]],cluster.chi[[6]][[3]],cluster.chi[[6]][[4]]), lda_kmeans = c(cluster.chi[[7]][[1]], cluster.chi[[7]][[2]],cluster.chi[[7]][[3]],cluster.chi[[7]][[4]]), row.names = c("tf_tfidf","tf_rst","tfidf_tfidf","tfidf_rst")),2)

# UC.06 Informationen visualisieren
print(cluster.alloc.df.combined.chi.data)

# UC.07 Informationen austauschen
uc05_xlsx_list <- append(uc05_xlsx_list, list(chi = cluster.alloc.df.combined.chi.data))
uc07_data(cluster.alloc.df.combined.chi.data,"xlsx")
# write.xlsx(cluster.alloc.df.combined.chi.data, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/cluster.alloc.df.combined.chi.data_",cv,cc,".xlsx", sep=""))
```

## The Silhouette Coefficient
### function section
```{r}
# function to visualize and share the silhouette coefficient results w/ distance matrix
# UC.06 and UC.07
vis_and_share.clus_silh_ggplot <- function(clus.alloc.obj, dist.matrix, subtitle, filename) { 
  clus_silh_ggplot <- fviz_silhouette(sil.obj = silhouette(clus.alloc.obj, dist.matrix, palette ="jco", ggtheme = theme_classic()))
  clus_silh_ggplot <- clus_silh_ggplot +ggtitle("Evaluation of cluster allocations", subtitle = paste(subtitle, cluster.cnt.overall,"\nAverage silhouette width:", round(mean(clus_silh_ggplot$data$sil_width),2)))
  ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/",filename,cv,cc,".png", sep = ""), plot = clus_silh_ggplot, dpi = 300)
  return(clus_silh_ggplot) 
}

# function to visualize and share the silhouette coefficient results w/o distance matrix
# UC.06 and UC.07
vis_and_share.pam.clus_silh_ggplot <- function(clus.alloc.obj, subtitle, filename) { 
  clus_silh_ggplot <- fviz_silhouette(clus.alloc.obj, palette ="jco", ggtheme = theme_classic())
  clus_silh_ggplot <- clus_silh_ggplot +ggtitle("Evaluation of cluster allocations", subtitle = paste(subtitle, cluster.cnt.overall,"\nAverage silhouette width:", round(mean(clus_silh_ggplot$data$sil_width),2)))
  ggsave(file = paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/pics/",filename,cv,cc,".png", sep = ""), plot = clus_silh_ggplot, dpi = 300)
  return(clus_silh_ggplot) 
}
```

### index calculation
```{r}
# references:
# https://stackoverflow.com/questions/33999224/silhouette-plot-in-r
# https://rstudio-pubs-static.s3.amazonaws.com/375287_5021917f670c435bb0458af333716136.html
# https://rdrr.io/cran/factoextra/man/fviz_silhouette.html

# Observations with a large silhouhette Si (almost 1) are very well clustered.
# A small Si (around 0) means that the observation lies between two clusters.
# Observations with a negative Si are probably placed in the wrong cluster.

# UC.06 Informationen visualisieren
# for cosine
tdm.tf.features.reducedby.tfidf.cosine.sim.dist.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df$cluster_number, tdm.tf.features.reducedby.tfidf.cosine.sim.dist, "Cluster silhouette plot; Silhouette coefficient; tdm.tf.features.reducedby.tfidf; cosine; k =", "tdm.tf.features.reducedby.tfidf.cosine.sim.dist.clus_silh_ggplot_")

tdm.tf.features.reducedby.rst.cosine.sim.dist.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(tdm.tf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df$cluster_number, tdm.tf.features.reducedby.rst.cosine.sim.dist, "Cluster silhouette plot; Silhouette coefficient; tdm.tf.features.reducedby.rst; cosine; k =", "tdm.tf.features.reducedby.rst.cosine.sim.dist.clus_silh_ggplot_")

tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.hclust.alloc.df$cluster_number, tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist, "Cluster silhouette plot; Silhouette coefficient; tdm.tfidf.features.reducedby.tfidf; cosine; k =", "tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.clus_silh_ggplot_")

tdm.tfidf.features.reducedby.rst.cosine.sim.dist.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.hclust.alloc.df$cluster_number, tdm.tfidf.features.reducedby.rst.cosine.sim.dist, "Cluster silhouette plot; Silhouette coefficient; tdm.tfidf.features.reducedby.rst; cosine; k =", "tdm.tfidf.features.reducedby.rst.cosine.sim.dist.clus_silh_ggplot_")

# for kmeans
dtm.tf.features.reducedby.tfidf.matrix.df.kmeans.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tf.features.reducedby.tfidf.matrix.df.kmeans$cluster, dist(dtm.tf.features.reducedby.tfidf.matrix.df)^2, "Cluster silhouette plot; Silhouette coefficient; dtm.tf.features.reducedby.tfidf; kmeans; k =", "dtm.tf.features.reducedby.tfidf.matrix.df.kmeans.clus_silh_ggplot_")

dtm.tf.features.reducedby.rst.matrix.df.kmeans.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tf.features.reducedby.rst.matrix.df.kmeans$cluster, dist(dtm.tf.features.reducedby.rst.matrix.df)^2, "Cluster silhouette plot; Silhouette coefficient; dtm.tf.features.reducedby.rst; kmeans; k =", "dtm.tf.features.reducedby.rst.matrix.df.kmeans.clus_silh_ggplot_")

dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans$cluster, dist(dtm.tfidf.features.reducedby.tfidf.matrix.df)^2, "Cluster silhouette plot; Silhouette coefficient; dtm.tfidf.features.reducedby.tfidf; kmeans; k =", "dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans.clus_silh_ggplot_")

dtm.tfidf.features.reducedby.rst.matrix.df.kmeans.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tfidf.features.reducedby.rst.matrix.df.kmeans$cluster, dist(dtm.tfidf.features.reducedby.rst.matrix.df)^2, "Cluster silhouette plot; Silhouette coefficient; dtm.tfidf.features.reducedby.rst; kmeans; k =", "dtm.tfidf.features.reducedby.rst.matrix.df.kmeans.clus_silh_ggplot_")

# for kmedoids
dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids.clus_silh_ggplot <- vis_and_share.pam.clus_silh_ggplot(dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids,"Cluster silhouette plot; Silhouette coefficient; dtm.tf.features.reducedby.tfidf; kmedoids; k =","dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids.clus_silh_ggplot_")

dtm.tf.features.reducedby.rst.matrix.df.kmedoids.clus_silh_ggplot <- vis_and_share.pam.clus_silh_ggplot(dtm.tf.features.reducedby.rst.matrix.df.kmedoids,"Cluster silhouette plot; Silhouette coefficient; dtm.tf.features.reducedby.rst; kmedoids; k =","dtm.tf.features.reducedby.rst.matrix.df.kmedoids.clus_silh_ggplot_")

dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids.clus_silh_ggplot <- vis_and_share.pam.clus_silh_ggplot(dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids,"Cluster silhouette plot; Silhouette coefficient; dtm.tfidf.features.reducedby.tfidf; kmedoids; k =","dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids.clus_silh_ggplot_")

dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids.clus_silh_ggplot <- vis_and_share.pam.clus_silh_ggplot(dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids,"Cluster silhouette plot; Silhouette coefficient; dtm.tfidf.features.reducedby.rst; kmedoids; k =","dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids.clus_silh_ggplot_")

# for lsa with kmeans
tdm.tf.features.reducedby.tfidf.myLSAspace.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(tdm.tf.features.reducedby.tfidf.myLSAspace.kmeans$cluster, dist(tdm.tf.features.reducedby.tfidf.myLSAspace$dk)^2, "Cluster silhouette plot; Silhouette coefficient; tdm.tf.features.reducedby.tfidf; LSA with kmeans; k =", "tdm.tf.features.reducedby.tfidf.myLSAspace.clus_silh_ggplot_")

tdm.tf.features.reducedby.rst.myLSAspace.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(tdm.tf.features.reducedby.rst.myLSAspace.kmeans$cluster, dist(tdm.tf.features.reducedby.rst.myLSAspace$dk)^2, "Cluster silhouette plot; Silhouette coefficient; tdm.tf.features.reducedby.rst; LSA with kmeans; k =", "tdm.tf.features.reducedby.rst.myLSAspace.clus_silh_ggplot_")

tdm.tfidf.features.reducedby.tfidf.myLSAspace.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(tdm.tfidf.features.reducedby.tfidf.myLSAspace.kmeans$cluster, dist(tdm.tfidf.features.reducedby.tfidf.myLSAspace$dk)^2, "Cluster silhouette plot; Silhouette coefficient; tdm.tfidf.features.reducedby.tfidf; LSA with kmeans; k =", "tdm.tfidf.features.reducedby.tfidf.myLSAspace.clus_silh_ggplot_")

tdm.tfidf.features.reducedby.rst.myLSAspace.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(tdm.tfidf.features.reducedby.rst.myLSAspace.kmeans$cluster, dist(tdm.tfidf.features.reducedby.rst.myLSAspace$dk)^2, "Cluster silhouette plot; Silhouette coefficient; tdm.tfidf.features.reducedby.rst; LSA with kmeans; k =", "tdm.tfidf.features.reducedby.rst.myLSAspace.clus_silh_ggplot_")

# for lda with topics
dtm.tf.features.reducedby.tfidf.lda.topics.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tf.features.reducedby.tfidf.lda.results.pseudo.cluster$lda_topic_cluster, dist(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma), "Cluster silhouette plot; Silhouette coefficient; dtm.tf.features.reducedby.tfidf; LDA with topics; k =", "dtm.tf.features.reducedby.tfidf.lda.topics.clus_silh_ggplot_")

dtm.tf.features.reducedby.rst.lda.topics.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tf.features.reducedby.rst.lda.results.pseudo.cluster$lda_topic_cluster, dist(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma), "Cluster silhouette plot; Silhouette coefficient; dtm.tf.features.reducedby.rst; LDA with topics; k =", "dtm.tf.features.reducedby.rst.lda.topics.clus_silh_ggplot_")

dtm.tfidf.features.reducedby.tfidf.lda.topics.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tfidf.features.reducedby.tfidf.lda.results.pseudo.cluster$lda_topic_cluster, dist(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma), "Cluster silhouette plot; Silhouette coefficient; dtm.tfidf.features.reducedby.tfidf; LDA with topics; k =", "dtm.tfidf.features.reducedby.tfidf.lda.topics.clus_silh_ggplot_")

dtm.tfidf.features.reducedby.rst.lda.topics.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tfidf.features.reducedby.rst.lda.results.pseudo.cluster$lda_topic_cluster, dist(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma), "Cluster silhouette plot; Silhouette coefficient; dtm.tfidf.features.reducedby.rst; LDA with topics; k =", "dtm.tfidf.features.reducedby.rst.lda.topics.clus_silh_ggplot_")

# for lda with kmeans
dtm.tf.features.reducedby.tfidf.lda.kmeans.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tf.features.reducedby.tfidf.lda.results.kmeans.cluster$cluster, dist(dtm.tf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma)^2, "Cluster silhouette plot; Silhouette coefficient; dtm.tf.features.reducedby.tfidf; LDA with kmeans; k =", "dtm.tf.features.reducedby.tfidf.lda.kmeans.clus_silh_ggplot_")

dtm.tf.features.reducedby.rst.lda.kmeans.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tf.features.reducedby.rst.lda.results.kmeans.cluster$cluster, dist(dtm.tf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma)^2, "Cluster silhouette plot; Silhouette coefficient; dtm.tf.features.reducedby.rst; LDA with kmeans; k =", "dtm.tf.features.reducedby.rst.lda.kmeans.clus_silh_ggplot_")

dtm.tfidf.features.reducedby.tfidf.lda.kmeans.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tfidf.features.reducedby.tfidf.lda.results.kmeans.cluster$cluster, dist(dtm.tfidf.features.reducedby.tfidf.lda.results[[lda.topic.entropy.selector]]@gamma)^2, "Cluster silhouette plot; Silhouette coefficient; dtm.tfidf.features.reducedby.tfidf; LDA with kmeans; k =", "dtm.tfidf.features.reducedby.tfidf.lda.kmeans.clus_silh_ggplot_")

dtm.tfidf.features.reducedby.rst.lda.kmeans.clus_silh_ggplot <- vis_and_share.clus_silh_ggplot(dtm.tfidf.features.reducedby.rst.lda.results.kmeans.cluster$cluster, dist(dtm.tfidf.features.reducedby.rst.lda.results[[lda.topic.entropy.selector]]@gamma)^2, "Cluster silhouette plot; Silhouette coefficient; dtm.tfidf.features.reducedby.rst; LDA with kmeans; k =", "dtm.tfidf.features.reducedby.rst.lda.kmeans.clus_silh_ggplot_")

clus_silh_ggplot <- list(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.clus_silh_ggplot,
tdm.tf.features.reducedby.rst.cosine.sim.dist.clus_silh_ggplot,
tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.clus_silh_ggplot,
tdm.tfidf.features.reducedby.rst.cosine.sim.dist.clus_silh_ggplot,
dtm.tf.features.reducedby.tfidf.matrix.df.kmeans.clus_silh_ggplot,
dtm.tf.features.reducedby.rst.matrix.df.kmeans.clus_silh_ggplot,
dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans.clus_silh_ggplot,
dtm.tfidf.features.reducedby.rst.matrix.df.kmeans.clus_silh_ggplot,
dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids.clus_silh_ggplot,
dtm.tf.features.reducedby.rst.matrix.df.kmedoids.clus_silh_ggplot,
dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids.clus_silh_ggplot,
dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids.clus_silh_ggplot,
tdm.tf.features.reducedby.tfidf.myLSAspace.clus_silh_ggplot,
tdm.tf.features.reducedby.rst.myLSAspace.clus_silh_ggplot,
tdm.tfidf.features.reducedby.tfidf.myLSAspace.clus_silh_ggplot,
tdm.tfidf.features.reducedby.rst.myLSAspace.clus_silh_ggplot,
dtm.tf.features.reducedby.tfidf.lda.topics.clus_silh_ggplot,
dtm.tf.features.reducedby.rst.lda.topics.clus_silh_ggplot,
dtm.tfidf.features.reducedby.tfidf.lda.topics.clus_silh_ggplot,
dtm.tfidf.features.reducedby.rst.lda.topics.clus_silh_ggplot,
dtm.tf.features.reducedby.tfidf.lda.kmeans.clus_silh_ggplot,
dtm.tf.features.reducedby.rst.lda.kmeans.clus_silh_ggplot,
dtm.tfidf.features.reducedby.tfidf.lda.kmeans.clus_silh_ggplot,
dtm.tfidf.features.reducedby.rst.lda.kmeans.clus_silh_ggplot)

clus_silh_ggplot

```


```{r}
# prepare the results for "The Silhouette coefficient"
cluster.alloc.df.combined.sil.data.sil_width <- data.frame(cosine_res = c(round(mean(tdm.tf.features.reducedby.tfidf.cosine.sim.dist.clus_silh_ggplot$data$sil_width),2), round(mean(tdm.tf.features.reducedby.rst.cosine.sim.dist.clus_silh_ggplot$data$sil_width),2), round(mean(tdm.tfidf.features.reducedby.tfidf.cosine.sim.dist.clus_silh_ggplot$data$sil_width),2), round(mean(tdm.tfidf.features.reducedby.rst.cosine.sim.dist.clus_silh_ggplot$data$sil_width),2)), kmeans_res = c(round(mean(dtm.tf.features.reducedby.tfidf.matrix.df.kmeans.clus_silh_ggplot$data$sil_width),2),                      round(mean(dtm.tf.features.reducedby.rst.matrix.df.kmeans.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tfidf.features.reducedby.tfidf.matrix.df.kmeans.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tfidf.features.reducedby.rst.matrix.df.kmeans.clus_silh_ggplot$data$sil_width),2)), kmedoids_res = c(round(mean(dtm.tf.features.reducedby.tfidf.matrix.df.kmedoids.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tf.features.reducedby.rst.matrix.df.kmedoids.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tfidf.features.reducedby.tfidf.matrix.df.kmedoids.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tfidf.features.reducedby.rst.matrix.df.kmedoids.clus_silh_ggplot$data$sil_width),2)), lsa_res = c(round(mean(tdm.tf.features.reducedby.tfidf.myLSAspace.clus_silh_ggplot$data$sil_width),2), round(mean(tdm.tf.features.reducedby.rst.myLSAspace.clus_silh_ggplot$data$sil_width),2), round(mean(tdm.tfidf.features.reducedby.tfidf.myLSAspace.clus_silh_ggplot$data$sil_width),2), round(mean(tdm.tfidf.features.reducedby.rst.myLSAspace.clus_silh_ggplot$data$sil_width),2)), lda_top_res = c(round(mean(dtm.tf.features.reducedby.tfidf.lda.topics.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tf.features.reducedby.rst.lda.topics.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tfidf.features.reducedby.tfidf.lda.topics.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tfidf.features.reducedby.rst.lda.topics.clus_silh_ggplot$data$sil_width),2)), lda_kmeans_res = c(round(mean(dtm.tf.features.reducedby.tfidf.lda.kmeans.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tf.features.reducedby.rst.lda.kmeans.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tfidf.features.reducedby.tfidf.lda.kmeans.clus_silh_ggplot$data$sil_width),2), round(mean(dtm.tfidf.features.reducedby.rst.lda.kmeans.clus_silh_ggplot$data$sil_width),2)), row.names = c("tf_tfidf","tf_rst","tfidf_tfidf","tfidf_rst"))

# UC.06 Informationen visualisieren
print(cluster.alloc.df.combined.sil.data.sil_width)

# UC.07 Informationen austauschen
uc05_xlsx_list <- append(uc05_xlsx_list, list(sil = cluster.alloc.df.combined.sil.data.sil_width))
uc07_data(cluster.alloc.df.combined.sil.data.sil_width,"xlsx")
# write.xlsx(cluster.alloc.df.combined.sil.data.sil_width, paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/cluster.alloc.df.combined.sil.data.sil_width_",cv,cc,".xlsx", sep=""))

```
## save the data as xlsx files
```{r}
uc05_wb = createWorkbook(type = "xlsx")

for (item in 1:length(uc05_xlsx_list)) {
  sheet = createSheet(uc05_wb, sheetName = names(uc05_xlsx_list)[item])
  addDataFrame(as.data.frame(uc05_xlsx_list[[item]]), sheet = sheet)
}

saveWorkbook(uc05_wb,paste("~/Library/Mobile\ Documents/com~apple~CloudDocs/r-workspace/data/uc05_wb_",cv,".xlsx", sep=""))
```







